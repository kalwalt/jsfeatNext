!function(t,e){"object"==typeof exports&&"object"==typeof module?module.exports=e():"function"==typeof define&&define.amd?define([],e):"object"==typeof exports?exports.jsfeatNext=e():t.jsfeatNext=e()}(this,(()=>(()=>{"use strict";var t={d:(e,r)=>{for(var a in r)t.o(r,a)&&!t.o(e,a)&&Object.defineProperty(e,a,{enumerable:!0,get:r[a]})},o:(t,e)=>Object.prototype.hasOwnProperty.call(t,e),r:t=>{"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(t,"__esModule",{value:!0})}},e={};t.d(e,{default:()=>T});var r={};function a(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function i(t,e){for(var r=0;r<e.length;r++){var a=e[r];a.enumerable=a.enumerable||!1,a.configurable=!0,"value"in a&&(a.writable=!0),Object.defineProperty(t,a.key,a)}}function f(t,e,r){return e&&i(t.prototype,e),r&&i(t,r),Object.defineProperty(t,"prototype",{writable:!1}),t}function o(t,e,r){return e in t?Object.defineProperty(t,e,{value:r,enumerable:!0,configurable:!0,writable:!0}):t[e]=r,t}t.r(r);var n=function(){function t(){a(this,t),this._data_type_size=new Int32Array([-1,1,4,-1,4,-1,-1,-1,8,-1,-1,-1,-1,-1,-1,-1,8])}return f(t,[{key:"_get_data_type",value:function(t){return 65280&t}},{key:"_get_channel",value:function(t){return 255&t}},{key:"_get_data_type_size",value:function(t){return this._data_type_size[(65280&t)>>8]}}]),t}(),s=f((function t(e,r){a(this,t),this.size=-8&(e+7|0),void 0===r?this.buffer=new ArrayBuffer(this.size):(this.buffer=r,this.size=r.length),this.u8=new Uint8Array(this.buffer),this.i32=new Int32Array(this.buffer),this.f32=new Float32Array(this.buffer),this.f64=new Float64Array(this.buffer)})),h=function(){function t(e){a(this,t),this.next=null,this.data=new s(e),this.size=this.data.size,this.buffer=this.data.buffer,this.u8=this.data.u8,this.i32=this.data.i32,this.f32=this.data.f32,this.f64=this.data.f64}return f(t,[{key:"resize",value:function(t){delete this.data,this.data=new s(t),this.size=this.data.size,this.buffer=this.data.buffer,this.u8=this.data.u8,this.i32=this.data.i32,this.f32=this.data.f32,this.f64=this.data.f64}}]),t}(),u=function(){function t(){a(this,t),this._pool_head,this._pool_tail,this._pool_size=0}return f(t,[{key:"allocate",value:function(t,e){this._pool_head=this._pool_tail=new h(e);for(var r=0;r<t;++r){var a=new h(e);this._pool_tail=this._pool_tail.next=a,this._pool_size++}}},{key:"get_buffer",value:function(t){var e=this._pool_head;return this._pool_head=this._pool_head.next,this._pool_size--,t>e.size&&e.resize(t),e}},{key:"put_buffer",value:function(t){this._pool_tail=this._pool_tail.next=t,this._pool_size++}}]),t}(),c=f((function t(e,r,i,f,o){a(this,t),void 0===e&&(e=0),void 0===r&&(r=0),void 0===i&&(i=0),void 0===f&&(f=0),void 0===o&&(o=-1),this.x=e,this.y=r,this.score=i,this.level=f,this.angle=o})),_={EPSILON:1.192092896e-7,FLT_MIN:1e-37,U8_t:256,S32_t:512,F32_t:1024,S64_t:2048,F64_t:4096,C1_t:1,C2_t:2,C3_t:3,C4_t:4,COLOR_RGBA2GRAY:0,COLOR_RGB2GRAY:1,COLOR_BGRA2GRAY:2,COLOR_BGR2GRAY:3,BOX_BLUR_NOSCALE:1,SVD_U_T:1,SVD_V_T:2},d=function(){function t(){a(this,t),this.cache=new u,this.cache.allocate(30,2560),this.qsort_stack=new Int32Array(96)}return f(t,[{key:"get_gaussian_kernel",value:function(t,e,r,a){var i=0,f=0,o=0,n=0,s=0,h=0,u=this.cache.get_buffer(t<<2),c=u.f32;if(1==(1&t)&&t<=7&&e<=0)switch(t>>1){case 0:c[0]=1,h=1;break;case 1:c[0]=.25,c[1]=.5,c[2]=.25,h=1;break;case 2:c[0]=.0625,c[1]=.25,c[2]=.375,c[3]=.25,c[4]=.0625,h=1;break;case 3:c[0]=.03125,c[1]=.109375,c[2]=.21875,c[3]=.28125,c[4]=.21875,c[5]=.109375,c[6]=.03125,h=1}else for(s=-.5/((n=e>0?e:.3*(.5*(t-1)-1)+.8)*n);i<t;++i)f=i-.5*(t-1),o=Math.exp(s*f*f),c[i]=o,h+=o;if(a&_.U8_t)for(h=256/h,i=0;i<t;++i)r[i]=c[i]*h+.5|0;else for(h=1/h,i=0;i<t;++i)r[i]=c[i]*h;this.cache.put_buffer(u)}},{key:"perspective_4point_transform",value:function(t,e,r,a,i,f,o,n,s,h,u,c,_,d,l,b,v){var p=e,y=h,w=o,m=p*y*w,k=l,M=p*k,g=y*M,x=u,O=p*x,C=f,R=r,S=d,A=R*S,L=A*C,z=S*C*x,G=S*w,U=S*x,B=y*w,I=k*y,F=k*C,P=x*C,T=1/(G-U-B+I-F+P),q=p*S,E=R*C,N=w*p,j=k*N,V=R*y,Y=A*x,D=R*x*C,J=w*k*y,X=k*R,H=-(g-m+O*C-C*M-A*y+L-z+G*y)*T,Q=(m-g-q*w+q*x+L-y*E+F*y-z)*T,K=p,W=(-x*M+j+V*w-A*w+Y-D+F*x-J)*T,Z=(N*x-j-X*y+Y-D+X*C+J-G*x)*T,$=R,tt=(-O+N+V-E+U-G-I+F)*T,et=(-M+O+A-V+F-P-G+B)*T,rt=-((g=(y=c)*(M=(p=a)*(k=v)))-(m=p*y*(w=s))+(O=p*(x=_))*(C=n)-C*M-(A=(R=i)*(S=b))*y+(L=A*C)-(z=S*C*x)+(G=S*w)*y)*(T=1/(G-(U=S*x)-(B=y*w)+(I=k*y)-(F=k*C)+(P=x*C))),at=(m-g-(q=p*S)*w+q*x+L-y*(E=R*C)+F*y-z)*T,it=p,ft=(-x*M+(j=k*(N=w*p))+(V=R*y)*w-A*w+(Y=A*x)-(D=R*x*C)+F*x-(J=w*k*y))*T,ot=(N*x-j-(X=k*R)*y+Y-D+X*C+J-G*x)*T,nt=R,st=(-O+N+V-E+U-G-I+F)*T,ht=(-M+O+A-V+F-P-G+B)*T,ut=K*tt;L=$*tt-W;var ct=-W*et+Z*tt,_t=H-ut;E=H*et-(O=Q*tt);var dt=(m=H*$)-(g=K*W),lt=(w=H*Z)-(M=W*Q);D=(y=Z-et*$)*(S=1/(w-m*et-M+g*et+O*$-ut*Z));var bt=(P=K*et-Q)*S,vt=(N=-Q*$+K*Z)*S,pt=t.data;pt[0]=rt*D+at*(L*S)-it*(ct*S),pt[1]=rt*bt+at*(_t*S)-it*(E*S),pt[2]=-rt*vt-at*(dt*S)+it*(lt*S),pt[3]=ft*D+ot*(L*S)-nt*(ct*S),pt[4]=ft*bt+ot*(_t*S)-nt*(E*S),pt[5]=-ft*vt-ot*(dt*S)+nt*(lt*S),pt[6]=st*D+ht*(L*S)-ct*S,pt[7]=st*bt+ht*(_t*S)-E*S,pt[8]=-st*vt-ht*(dt*S)+lt*S}},{key:"qsort",value:function(t,e,r,a){var i,f,o,n,s=0,h=0,u=0,c=0,_=0,d=0,l=0,b=0,v=0,p=0,y=0,w=0,m=0,k=0,M=0,g=0,x=0,O=0,C=this.qsort_stack;if(!(r-e+1<=1))for(C[0]=e,C[1]=r;s>=0;)for(h=C[s<<1],u=C[1+(s<<1)],s--;;){if((_=u-h+1)<=7){for(l=h+1;l<=u;l++)for(b=l;b>h&&a(t[b],t[b-1]);b--)i=t[b],t[b]=t[b-1],t[b-1]=i;break}for(O=0,p=h,w=u,k=h+(_>>1),_>40&&(g=h+(v=_>>3),x=h+(v<<1),f=t[M=h],o=t[g],n=t[x],h=a(f,o)?a(o,n)?g:a(f,n)?x:M:a(n,o)?g:a(f,n)?M:x,g=k,x=k+v,f=t[M=k-v],o=t[g],n=t[x],k=a(f,o)?a(o,n)?g:a(f,n)?x:M:a(n,o)?g:a(f,n)?M:x,g=u-v,x=u,f=t[M=u-(v<<1)],o=t[g],n=t[x],u=a(f,o)?a(o,n)?g:a(f,n)?x:M:a(n,o)?g:a(f,n)?M:x),g=k,x=u,f=t[M=h],o=t[g],n=t[x],(k=a(f,o)?a(o,n)?g:a(f,n)?x:M:a(n,o)?g:a(f,n)?M:x)!=p&&(i=t[k],t[k]=t[p],t[p]=i,k=p),h=y=p+1,u=m=w,f=t[k];;){for(;h<=u&&!a(f,t[h]);)a(t[h],f)||(h>y&&(i=t[y],t[y]=t[h],t[h]=i),O=1,y++),h++;for(;h<=u&&!a(t[u],f);)a(f,t[u])||(u<m&&(i=t[m],t[m]=t[u],t[u]=i),O=1,m--),u--;if(h>u)break;i=t[h],t[h]=t[u],t[u]=i,O=1,h++,u--}if(0==O){for(u=w,l=(h=p)+1;l<=u;l++)for(b=l;b>h&&a(t[b],t[b-1]);b--)i=t[b],t[b]=t[b-1],t[b-1]=i;break}for(d=h-(_=Math.min(y-p,h-y))|0,c=0;c<_;++c,++d)i=t[p+c],t[p+c]=t[d],t[d]=i;for(d=w-(_=Math.min(w-m,m-u))+1|0,c=0;c<_;++c,++d)i=t[h+c],t[h+c]=t[d],t[d]=i;if(d=m-u,(_=h-y)>1)d>1?_>d?(C[++s<<1]=p,C[1+(s<<1)]=p+_-1,h=w-d+1,u=w):(C[++s<<1]=w-d+1,C[1+(s<<1)]=w,h=p,u=p+_-1):(h=p,u=p+_-1);else{if(!(d>1))break;h=w-d+1,u=w}}}},{key:"median",value:function(t,e,r){for(var a,i=0,f=0,o=0,n=e+r>>1;;){if(r<=e)return t[n];if(r==e+1)return t[e]>t[r]&&(a=t[e],t[e]=t[r],t[r]=a),t[n];for(t[i=e+r>>1]>t[r]&&(a=t[i],t[i]=t[r],t[r]=a),t[e]>t[r]&&(a=t[e],t[e]=t[r],t[r]=a),t[i]>t[e]&&(a=t[i],t[i]=t[e],t[e]=a),f=e+1,a=t[i],t[i]=t[f],t[f]=a,o=r;;){do{++f}while(t[e]>t[f]);do{--o}while(t[o]>t[e]);if(o<f)break;a=t[f],t[f]=t[o],t[o]=a}a=t[e],t[e]=t[o],t[o]=a,o<=n?e=f:o>=n&&(r=o-1)}return 0}}]),t}(),l=function(){function t(e,r,i,f){a(this,t),this.dt=new n,this.type=0|this.dt._get_data_type(i),this.channel=0|this.dt._get_channel(i),this.cols=0|e,this.rows=0|r,void 0===f?this.allocate():(this.buffer=f,this.data=this.type&_.U8_t?this.buffer.u8:this.type&_.S32_t?this.buffer.i32:this.type&_.F32_t?this.buffer.f32:this.buffer.f64)}return f(t,[{key:"allocate",value:function(){delete this.data,delete this.buffer,this.buffer=new s(this.cols*this.dt._get_data_type_size(this.type)*this.channel*this.rows),this.data=this.type&_.U8_t?this.buffer.u8:this.type&_.S32_t?this.buffer.i32:this.type&_.F32_t?this.buffer.f32:this.buffer.f64}},{key:"copy_to",value:function(t){for(var e=t.data,r=this.data,a=0,i=this.cols*this.rows*this.channel|0;a<i-4;a+=4)e[a]=r[a],e[a+1]=r[a+1],e[a+2]=r[a+2],e[a+3]=r[a+3];for(;a<i;++a)e[a]=r[a]}},{key:"resize",value:function(t,e,r){void 0===r&&(r=this.channel),t*this.dt._get_data_type_size(this.type)*r*e>this.buffer.size?(this.cols=t,this.rows=e,this.channel=r,this.allocate()):(this.cols=t,this.rows=e,this.channel=r)}}]),t}(),b=function(){function t(){a(this,t),this.cache=new u,this.cache.allocate(30,2560)}return f(t,[{key:"grayscale",value:function(t,e,r,a,i){void 0===i&&(i=_.COLOR_RGBA2GRAY);var f=0,o=0,n=0,s=0,h=0,u=0,c=4899,d=9617,l=1868,b=4;i!=_.COLOR_BGRA2GRAY&&i!=_.COLOR_BGR2GRAY||(c=1868,l=4899),i!=_.COLOR_RGB2GRAY&&i!=_.COLOR_BGR2GRAY||(b=3);var v=b<<1,p=3*b|0;a.resize(e,r,1);var y=a.data;for(o=0;o<r;++o,s+=e,n+=e*b){for(f=0,h=n,u=s;f<=e-4;f+=4,h+=b<<2,u+=4)y[u]=t[h]*c+t[h+1]*d+t[h+2]*l+8192>>14,y[u+1]=t[h+b]*c+t[h+b+1]*d+t[h+b+2]*l+8192>>14,y[u+2]=t[h+v]*c+t[h+v+1]*d+t[h+v+2]*l+8192>>14,y[u+3]=t[h+p]*c+t[h+p+1]*d+t[h+p+2]*l+8192>>14;for(;f<e;++f,++u,h+=b)y[u]=t[h]*c+t[h+1]*d+t[h+2]*l+8192>>14}}},{key:"resample",value:function(t,e,r,a){var i=t.rows,f=t.cols;i>a&&f>r&&(e.resize(r,a,t.channel),t.type&_.U8_t&&e.type&_.U8_t&&i*f/(a*r)<256?function(t,e,r,a,i){for(var f=0,o=t.channel,n=t.cols,s=t.rows,h=t.data,u=e.data,c=n/a,_=s/i,d=c*_*65536|0,l=0,b=0,v=0,p=0,y=0,w=0,m=0,k=0,M=0,g=0,x=0,O=0,C=0,R=0,S=0,A=0,L=r.get_buffer(a*o<<2),z=r.get_buffer(a*o<<2),G=r.get_buffer(2*n*3<<2),U=L.i32,B=z.i32,I=G.i32;l<a;l++){for(y=1+(M=l*c)-1e-6|0,w=0|(g=M+c),y=Math.min(y,n-1),w=Math.min(w,n-1),y>M&&(I[k++]=l*o|0,I[k++]=(y-1)*o|0,I[k++]=256*(y-M)|0,f++),v=y;v<w;v++)f++,I[k++]=l*o|0,I[k++]=v*o|0,I[k++]=256;g-w>.001&&(f++,I[k++]=l*o|0,I[k++]=w*o|0,I[k++]=256*(g-w)|0)}for(l=0;l<a*o;l++)U[l]=B[l]=0;for(b=0,p=0;p<s;p++){for(x=n*p,k=0;k<f;k++)for(C=I[3*k],y=I[3*k+1],R=I[3*k+2],m=0;m<o;m++)U[C+m]+=h[x+y+m]*R;if((b+1)*_<=p+1||p==s-1){if(A=256-(S=256*Math.max(p+1-(b+1)*_,0)|0),O=a*b,S<=0)for(l=0;l<a*o;l++)u[O+l]=Math.min(Math.max((B[l]+256*U[l])/d,0),255),B[l]=U[l]=0;else for(l=0;l<a*o;l++)u[O+l]=Math.min(Math.max((B[l]+U[l]*A)/d,0),255),B[l]=U[l]*S,U[l]=0;b++}else for(l=0;l<a*o;l++)B[l]+=256*U[l],U[l]=0}r.put_buffer(z),r.put_buffer(L),r.put_buffer(G)}(t,e,this.cache,r,a):function(t,e,r,a,i){for(var f=0,o=t.channel,n=t.cols,s=t.rows,h=t.data,u=e.data,c=n/a,_=s/i,d=1/(c*_),l=0,b=0,v=0,p=0,y=0,w=0,m=0,k=0,M=0,g=0,x=0,O=0,C=0,R=0,S=0,A=0,L=r.get_buffer(a*o<<2),z=r.get_buffer(a*o<<2),G=r.get_buffer(2*n*3<<2),U=L.f32,B=z.f32,I=G.f32;l<a;l++){for(y=1+(M=l*c)-1e-6|0,w=0|(g=M+c),y=Math.min(y,n-1),w=Math.min(w,n-1),y>M&&(f++,I[k++]=(y-1)*o|0,I[k++]=l*o|0,I[k++]=(y-M)*d),v=y;v<w;v++)f++,I[k++]=v*o|0,I[k++]=l*o|0,I[k++]=d;g-w>.001&&(f++,I[k++]=w*o|0,I[k++]=l*o|0,I[k++]=(g-w)*d)}for(l=0;l<a*o;l++)U[l]=B[l]=0;for(b=0,p=0;p<s;p++){for(x=n*p,k=0;k<f;k++)for(y=0|I[3*k],C=0|I[3*k+1],R=I[3*k+2],m=0;m<o;m++)U[C+m]+=h[x+y+m]*R;if((b+1)*_<=p+1||p==s-1){if(A=1-(S=Math.max(p+1-(b+1)*_,0)),O=a*b,Math.abs(S)<.001)for(l=0;l<a*o;l++)u[O+l]=B[l]+U[l],B[l]=U[l]=0;else for(l=0;l<a*o;l++)u[O+l]=B[l]+U[l]*A,B[l]=U[l]*S,U[l]=0;b++}else for(l=0;l<a*o;l++)B[l]+=U[l],U[l]=0}r.put_buffer(z),r.put_buffer(L),r.put_buffer(G)}(t,e,this.cache,r,a))}},{key:"box_blur_gray",value:function(t,e,r,a){void 0===a&&(a=0);var i=t.cols,f=t.rows,o=f<<1,n=i<<1,s=0,h=0,u=0,c=0,d=1+(r<<1)|0,l=r+1|0,b=l+1|0,v=a&_.BOX_BLUR_NOSCALE?1:1/(d*d),p=this.cache.get_buffer(i*f<<2),y=0,w=0,m=0,k=0,M=0,g=p.i32,x=t.data,O=0;for(e.resize(i,f,t.channel),u=0;u<f;++u){for(w=u,y=l*x[m],s=m+1|0,c=m+r|0;s<=c;++s)y+=x[s];for(k=m+l|0,O=x[M=m],h=0;h<r;++h,w+=f)g[w]=y,y+=x[k]-O,k++;for(;h<i-b;h+=2,w+=o)g[w]=y,y+=x[k]-x[M],g[w+f]=y,y+=x[k+1]-x[M+1],k+=2,M+=2;for(;h<i-l;++h,w+=f)g[w]=y,y+=x[k]-x[M],k++,M++;for(O=x[k-1];h<i;++h,w+=f)g[w]=y,y+=O-x[M],M++;m+=i}if(m=0,x=e.data,1==v)for(u=0;u<i;++u){for(w=u,y=l*g[m],s=m+1|0,c=m+r|0;s<=c;++s)y+=g[s];for(k=m+l,O=g[M=m],h=0;h<r;++h,w+=i)x[w]=y,y+=g[k]-O,k++;for(;h<f-b;h+=2,w+=n)x[w]=y,y+=g[k]-g[M],x[w+i]=y,y+=g[k+1]-g[M+1],k+=2,M+=2;for(;h<f-l;++h,w+=i)x[w]=y,y+=g[k]-g[M],k++,M++;for(O=g[k-1];h<f;++h,w+=i)x[w]=y,y+=O-g[M],M++;m+=f}else for(u=0;u<i;++u){for(w=u,y=l*g[m],s=m+1|0,c=m+r|0;s<=c;++s)y+=g[s];for(k=m+l,O=g[M=m],h=0;h<r;++h,w+=i)x[w]=y*v,y+=g[k]-O,k++;for(;h<f-b;h+=2,w+=n)x[w]=y*v,y+=g[k]-g[M],x[w+i]=y*v,y+=g[k+1]-g[M+1],k+=2,M+=2;for(;h<f-l;++h,w+=i)x[w]=y*v,y+=g[k]-g[M],k++,M++;for(O=g[k-1];h<f;++h,w+=i)x[w]=y*v,y+=O-g[M],M++;m+=f}this.cache.put_buffer(p)}},{key:"gaussian_blur",value:function(t,e,r,a){var i=new d;void 0===a&&(a=0),void 0===r&&(r=0);var f=(r=0==r?2*Math.max(1,4*a+1-1e-8)+1|0:r)>>1,o=t.cols,n=t.rows,s=t.type,h=s&_.U8_t;e.resize(o,n,t.channel);var u,c,l=t.data,b=e.data,v=r+Math.max(n,o)|0,p=this.cache.get_buffer(v<<2),y=this.cache.get_buffer(r<<2);h?(u=p.i32,c=y.i32):s&_.S32_t?(u=p.i32,c=y.f32):(u=p.f32,c=y.f32),i.get_gaussian_kernel(r,a,c,s),h?function(t,e,r,a,i,f,o,n){for(var s=0,h=0,u=0,c=0,_=0,d=0,l=0,b=0,v=0,p=f[0],y=0,w=a<<1,m=3*a,k=a<<2;s<i;++s){for(d=e[c],h=0;h<n;++h)t[h]=d;for(h=0;h<=a-2;h+=2)t[h+n]=e[c+h],t[h+n+1]=e[c+h+1];for(;h<a;++h)t[h+n]=e[c+h];for(d=e[c+a-1],h=a;h<n+a;++h)t[h+n]=d;for(h=0;h<=a-4;h+=4){for(d=t[h]*p,l=t[h+1]*p,b=t[h+2]*p,v=t[h+3]*p,u=1;u<o;++u)y=f[u],d+=t[u+h]*y,l+=t[u+h+1]*y,b+=t[u+h+2]*y,v+=t[u+h+3]*y;r[_+h]=Math.min(d>>8,255),r[_+h+1]=Math.min(l>>8,255),r[_+h+2]=Math.min(b>>8,255),r[_+h+3]=Math.min(v>>8,255)}for(;h<a;++h){for(d=t[h]*p,u=1;u<o;++u)d+=t[u+h]*f[u];r[_+h]=Math.min(d>>8,255)}c+=a,_+=a}for(s=0;s<a;++s){for(d=r[s],h=0;h<n;++h)t[h]=d;for(u=s,h=0;h<=i-2;h+=2,u+=w)t[h+n]=r[u],t[h+n+1]=r[u+a];for(;h<i;++h,u+=a)t[h+n]=r[u];for(d=r[(i-1)*a+s],h=i;h<n+i;++h)t[h+n]=d;for(_=s,h=0;h<=i-4;h+=4,_+=k){for(d=t[h]*p,l=t[h+1]*p,b=t[h+2]*p,v=t[h+3]*p,u=1;u<o;++u)y=f[u],d+=t[u+h]*y,l+=t[u+h+1]*y,b+=t[u+h+2]*y,v+=t[u+h+3]*y;r[_]=Math.min(d>>8,255),r[_+a]=Math.min(l>>8,255),r[_+w]=Math.min(b>>8,255),r[_+m]=Math.min(v>>8,255)}for(;h<i;++h,_+=a){for(d=t[h]*p,u=1;u<o;++u)d+=t[u+h]*f[u];r[_]=Math.min(d>>8,255)}}}(u,l,b,o,n,c,r,f):function(t,e,r,a,i,f,o,n){for(var s=0,h=0,u=0,c=0,_=0,d=0,l=0,b=0,v=0,p=f[0],y=0,w=a<<1,m=3*a,k=a<<2;s<i;++s){for(d=e[c],h=0;h<n;++h)t[h]=d;for(h=0;h<=a-2;h+=2)t[h+n]=e[c+h],t[h+n+1]=e[c+h+1];for(;h<a;++h)t[h+n]=e[c+h];for(d=e[c+a-1],h=a;h<n+a;++h)t[h+n]=d;for(h=0;h<=a-4;h+=4){for(d=t[h]*p,l=t[h+1]*p,b=t[h+2]*p,v=t[h+3]*p,u=1;u<o;++u)y=f[u],d+=t[u+h]*y,l+=t[u+h+1]*y,b+=t[u+h+2]*y,v+=t[u+h+3]*y;r[_+h]=d,r[_+h+1]=l,r[_+h+2]=b,r[_+h+3]=v}for(;h<a;++h){for(d=t[h]*p,u=1;u<o;++u)d+=t[u+h]*f[u];r[_+h]=d}c+=a,_+=a}for(s=0;s<a;++s){for(d=r[s],h=0;h<n;++h)t[h]=d;for(u=s,h=0;h<=i-2;h+=2,u+=w)t[h+n]=r[u],t[h+n+1]=r[u+a];for(;h<i;++h,u+=a)t[h+n]=r[u];for(d=r[(i-1)*a+s],h=i;h<n+i;++h)t[h+n]=d;for(_=s,h=0;h<=i-4;h+=4,_+=k){for(d=t[h]*p,l=t[h+1]*p,b=t[h+2]*p,v=t[h+3]*p,u=1;u<o;++u)y=f[u],d+=t[u+h]*y,l+=t[u+h+1]*y,b+=t[u+h+2]*y,v+=t[u+h+3]*y;r[_]=d,r[_+a]=l,r[_+w]=b,r[_+m]=v}for(;h<i;++h,_+=a){for(d=t[h]*p,u=1;u<o;++u)d+=t[u+h]*f[u];r[_]=d}}}(u,l,b,o,n,c,r,f),this.cache.put_buffer(p),this.cache.put_buffer(y)}},{key:"hough_transform",value:function(t,e,r,a){for(var i=t.data,f=t.cols,o=t.rows,n=f,s=Math.PI,h=Math.round((s-0)/r),u=Math.round((2*(f+o)+1)/e),c=1/e,_=new Int32Array((h+2)*(u+2)),d=new Float32Array(h),l=new Float32Array(h),b=0,v=0;b<h;b++)d[b]=Math.sin(v)*c,l[b]=Math.cos(v)*c,v+=r;for(var p=0;p<o;p++)for(var y=0;y<f;y++)if(0!=i[p*n+y])for(b=0;b<h;b++){var w=Math.round(y*l[b]+p*d[b]);_[(b+1)*(u+2)+(w+=(u-1)/2)+1]+=1}var m=new Array;for(w=0;w<u;w++)for(b=0;b<h;b++){var k=(b+1)*(u+2)+w+1;_[k]>a&&_[k]>_[k-1]&&_[k]>=_[k+1]&&_[k]>_[k-u-2]&&_[k]>=_[k+u+2]&&m.push(k)}m.sort((function(t,e){return _[t]>_[e]||_[t]==_[e]&&t<e}));var M=Math.min(h*u,m.length),g=1/(u+2),x=new Array;for(p=0;p<M;p++){var O=m[p],C=((w=O-(1+(b=Math.floor(O*g)-1))*(u+2)-1)-.5*(u-1))*e,R=b*r;x.push([C,R])}return x}},{key:"pyrdown",value:function(t,e,r,a){void 0===r&&(r=0),void 0===a&&(a=0);var i=t.cols,f=i>>1,o=t.rows>>1,n=f-(r<<1),s=o-(a<<1),h=0,u=0,c=r+a*i,_=0,d=0,l=0;e.resize(f,o,t.channel);var b=t.data,v=e.data;for(u=0;u<s;++u){for(_=c,l=d,h=0;h<=n-2;h+=2,l+=2,_+=4)v[l]=b[_]+b[_+1]+b[_+i]+b[_+i+1]+2>>2,v[l+1]=b[_+2]+b[_+3]+b[_+i+2]+b[_+i+3]+2>>2;for(;h<n;++h,++l,_+=2)v[l]=b[_]+b[_+1]+b[_+i]+b[_+i+1]+2>>2;c+=i<<1,d+=f}}},{key:"scharr_derivatives",value:function(t,e){var r,a,i,f,o,n,s,h,u=t.cols,c=t.rows,d=u<<1,l=0,b=0,v=0,p=0,y=0,w=0,m=0;e.resize(u,c,2);var k=t.data,M=e.data,g=this.cache.get_buffer(u+2<<2),x=this.cache.get_buffer(u+2<<2);for(t.type&_.U8_t||t.type&_.S32_t?(s=g.i32,h=x.i32):(s=g.f32,h=x.f32);b<c;++b,y+=u){for(p=(b>0?b-1:1)*u|0,w=(b<c-1?b+1:c-2)*u|0,m=b*d|0,l=0,v=1;l<=u-2;l+=2,v+=2)r=k[p+l],a=k[w+l],s[v]=3*(r+a)+10*k[y+l],h[v]=a-r,r=k[p+l+1],a=k[w+l+1],s[v+1]=3*(r+a)+10*k[y+l+1],h[v+1]=a-r;for(;l<u;++l,++v)r=k[p+l],a=k[w+l],s[v]=3*(r+a)+10*k[y+l],h[v]=a-r;for(l=u+1|0,s[0]=s[1],s[l]=s[u],h[0]=h[1],h[l]=h[u],l=0;l<=u-4;l+=4)r=h[l+2],a=h[l+1],i=h[l+3],f=h[l+4],o=s[l+2],n=s[l+3],M[m++]=o-s[l],M[m++]=3*(r+h[l])+10*a,M[m++]=n-s[l+1],M[m++]=3*(i+a)+10*r,M[m++]=s[l+4]-o,M[m++]=3*(f+r)+10*i,M[m++]=s[l+5]-n,M[m++]=3*(h[l+5]+i)+10*f;for(;l<u;++l)M[m++]=s[l+2]-s[l],M[m++]=3*(h[l+2]+h[l])+10*h[l+1]}this.cache.put_buffer(g),this.cache.put_buffer(x)}},{key:"sobel_derivatives",value:function(t,e){var r,a,i,f,o,n,s,h,u=t.cols,c=t.rows,d=u<<1,l=0,b=0,v=0,p=0,y=0,w=0,m=0;e.resize(u,c,2);var k=t.data,M=e.data,g=this.cache.get_buffer(u+2<<2),x=this.cache.get_buffer(u+2<<2);for(t.type&_.U8_t||t.type&_.S32_t?(s=g.i32,h=x.i32):(s=g.f32,h=x.f32);b<c;++b,y+=u){for(p=(b>0?b-1:1)*u|0,w=(b<c-1?b+1:c-2)*u|0,m=b*d|0,l=0,v=1;l<=u-2;l+=2,v+=2)r=k[p+l],a=k[w+l],s[v]=r+a+2*k[y+l],h[v]=a-r,r=k[p+l+1],a=k[w+l+1],s[v+1]=r+a+2*k[y+l+1],h[v+1]=a-r;for(;l<u;++l,++v)r=k[p+l],a=k[w+l],s[v]=r+a+2*k[y+l],h[v]=a-r;for(l=u+1|0,s[0]=s[1],s[l]=s[u],h[0]=h[1],h[l]=h[u],l=0;l<=u-4;l+=4)r=h[l+2],a=h[l+1],i=h[l+3],f=h[l+4],o=s[l+2],n=s[l+3],M[m++]=o-s[l],M[m++]=r+h[l]+2*a,M[m++]=n-s[l+1],M[m++]=i+a+2*r,M[m++]=s[l+4]-o,M[m++]=f+r+2*i,M[m++]=s[l+5]-n,M[m++]=h[l+5]+i+2*f;for(;l<u;++l)M[m++]=s[l+2]-s[l],M[m++]=h[l+2]+h[l]+2*h[l+1]}this.cache.put_buffer(g),this.cache.put_buffer(x)}},{key:"compute_integral_image",value:function(t,e,r,a){var i=0|t.cols,f=0|t.rows,o=t.data,n=i+1|0,s=0,h=0,u=0,c=0,_=0,d=0,l=0,b=0;if(e&&r){for(;_<n;++_)e[_]=0,r[_]=0;for(u=n+1|0,c=1,_=0,b=0;_<f;++_,++u,++c){for(s=h=0,d=0;d<=i-2;d+=2,b+=2,u+=2,c+=2)s+=l=o[b],h+=l*l,e[u]=e[c]+s,r[u]=r[c]+h,s+=l=o[b+1],h+=l*l,e[u+1]=e[c+1]+s,r[u+1]=r[c+1]+h;for(;d<i;++d,++b,++u,++c)s+=l=o[b],h+=l*l,e[u]=e[c]+s,r[u]=r[c]+h}}else if(e){for(;_<n;++_)e[_]=0;for(u=n+1|0,c=1,_=0,b=0;_<f;++_,++u,++c){for(s=0,d=0;d<=i-2;d+=2,b+=2,u+=2,c+=2)s+=o[b],e[u]=e[c]+s,s+=o[b+1],e[u+1]=e[c+1]+s;for(;d<i;++d,++b,++u,++c)s+=o[b],e[u]=e[c]+s}}else if(r){for(;_<n;++_)r[_]=0;for(u=n+1|0,c=1,_=0,b=0;_<f;++_,++u,++c){for(h=0,d=0;d<=i-2;d+=2,b+=2,u+=2,c+=2)h+=(l=o[b])*l,r[u]=r[c]+h,h+=(l=o[b+1])*l,r[u+1]=r[c+1]+h;for(;d<i;++d,++b,++u,++c)h+=(l=o[b])*l,r[u]=r[c]+h}}if(a){for(_=0;_<n;++_)a[_]=0;for(u=n+1|0,c=0,_=0,b=0;_<f;++_,++u,++c){for(d=0;d<=i-2;d+=2,b+=2,u+=2,c+=2)a[u]=o[b]+a[c],a[u+1]=o[b+1]+a[c+1];for(;d<i;++d,++b,++u,++c)a[u]=o[b]+a[c]}for(u=n+i|0,c=i,_=0;_<f;++_,u+=n,c+=n)a[u]+=a[c];for(d=i-1;d>0;--d)for(c=(u=d+f*n)-n,_=f;_>0;--_,u-=n,c-=n)a[u]+=a[c]+a[c+1]}}},{key:"equalize_histogram",value:function(t,e){var r=t.cols,a=t.rows,i=t.data;e.resize(r,a,t.channel);var f,o,n=e.data,s=r*a,h=0,u=0,c=this.cache.get_buffer(1024);for(f=c.i32;h<256;++h)f[h]=0;for(h=0;h<s;++h)++f[i[h]];for(u=f[0],h=1;h<256;++h)u=f[h]+=u;for(o=255/s,h=0;h<s;++h)n[h]=f[i[h]]*o+.5|0;this.cache.put_buffer(c)}},{key:"canny",value:function(t,e,r,a){var i=t.cols,f=t.rows;t.data,e.resize(i,f,t.channel);var o=e.data,n=0,s=0,h=0,u=i<<1,c=0,d=0,b=0,v=0,p=0,y=0,w=0,m=0,k=this.cache.get_buffer(f*u<<2),M=this.cache.get_buffer(3*(i+2)<<2),g=this.cache.get_buffer((f+2)*(i+2)<<2),x=this.cache.get_buffer(f*i<<2),O=M.i32,C=g.i32,R=x.i32,S=k.i32,A=new l(i,f,_.S32C2_t,k.data),L=1,z=i+2+1|0,G=2*(i+2)+1|0,U=i+2|0,B=U+1|0,I=0;for(this.sobel_derivatives(t,A),r>a&&(n=r,r=a,a=n),n=3*(i+2)|0;--n>=0;)O[n]=0;for(n=(f+2)*(i+2)|0;--n>=0;)C[n]=0;for(;s<i;++s,h+=2)v=S[h],p=S[h+1],O[z+s]=(v^v>>31)-(v>>31)+((p^p>>31)-(p>>31));for(n=1;n<=f;++n,h+=u){if(n==f)for(s=G+i;--s>=G;)O[s]=0;else for(s=0;s<i;s++)v=S[h+(s<<1)],p=S[h+(s<<1)+1],O[G+s]=(v^v>>31)-(v>>31)+((p^p>>31)-(p>>31));for(c=h-u|0,C[B-1]=0,d=0,s=0;s<i;++s,c+=2){if((b=O[z+s])>r)if(y=(v=S[c])^(p=S[c+1]),p=(p^p>>31)-(p>>31)|0,m=(w=13573*(v=(v^v>>31)-(v>>31)|0))+(v+v<<15),(p<<=15)<w){if(b>O[z+s-1]&&b>=O[z+s+1]){b>a&&!d&&2!=C[B+s-U]?(C[B+s]=2,d=1,R[I++]=B+s):C[B+s]=1;continue}}else if(p>m){if(b>O[L+s]&&b>=O[G+s]){b>a&&!d&&2!=C[B+s-U]?(C[B+s]=2,d=1,R[I++]=B+s):C[B+s]=1;continue}}else if(b>O[L+s-(y=y<0?-1:1)]&&b>O[G+s+y]){b>a&&!d&&2!=C[B+s-U]?(C[B+s]=2,d=1,R[I++]=B+s):C[B+s]=1;continue}C[B+s]=0,d=0}C[B+i]=0,B+=U,s=L,L=z,z=G,G=s}for(s=B-U-1,n=0;n<U;++n,++s)C[s]=0;for(;I>0;)B=R[--I],1==C[B-=U+1]&&(C[B]=2,R[I++]=B),1==C[B+=1]&&(C[B]=2,R[I++]=B),1==C[B+=1]&&(C[B]=2,R[I++]=B),1==C[B+=U]&&(C[B]=2,R[I++]=B),1==C[B-=2]&&(C[B]=2,R[I++]=B),1==C[B+=U]&&(C[B]=2,R[I++]=B),1==C[B+=1]&&(C[B]=2,R[I++]=B),1==C[B+=1]&&(C[B]=2,R[I++]=B);for(B=U+1,L=0,n=0;n<f;++n,B+=U)for(s=0;s<i;++s)o[L++]=255*(2==C[B+s]);this.cache.put_buffer(k),this.cache.put_buffer(M),this.cache.put_buffer(g),this.cache.put_buffer(x)}},{key:"warp_perspective",value:function(t,e,r,a){void 0===a&&(a=0);for(var i=0|t.cols,f=0|t.rows,o=0|e.cols,n=0|e.rows,s=t.data,h=e.data,u=0,c=0,_=0,d=0,l=0,b=0,v=0,p=0,y=0,w=0,m=0,k=0,M=0,g=0,x=0,O=r.data,C=O[0],R=O[1],S=O[2],A=O[3],L=O[4],z=O[5],G=O[6],U=O[7],B=O[8],I=0;c<n;++c)for(p=R*c+S,y=L*c+z,w=U*c+B,u=0;u<o;++u,++I,p+=C,y+=A,w+=G)d=0|(b=p*(m=1/w)),l=0|(v=y*m),b>0&&v>0&&d<i-1&&l<f-1?(k=Math.max(b-d,0),M=Math.max(v-l,0),g=s[_=i*l+d|0]+k*(s[_+1]-s[_]),x=s[_+i]+k*(s[_+i+1]-s[_+i]),h[I]=g+M*(x-g)):h[I]=a}},{key:"warp_affine",value:function(t,e,r,a){void 0===a&&(a=0);for(var i=t.cols,f=t.rows,o=e.cols,n=e.rows,s=t.data,h=e.data,u=0,c=0,_=0,d=0,l=0,b=0,v=0,p=0,y=0,w=0,m=0,k=r.data,M=k[0],g=k[1],x=k[2],O=k[3],C=k[4],R=k[5],S=0;c<n;++c)for(b=g*c+x,v=C*c+R,u=0;u<o;++u,++S,b+=M,v+=O)l=0|v,(d=0|b)>=0&&l>=0&&d<i-1&&l<f-1?(p=b-d,y=v-l,w=s[_=i*l+d]+p*(s[_+1]-s[_]),m=s[_+i]+p*(s[_+i+1]-s[_+i]),h[S]=w+y*(m-w)):h[S]=a}},{key:"skindetector",value:function(t,e){for(var r,a,i,f,o=t.width*t.height;o--;)f=4*o,r=t.data[f],a=t.data[f+1],i=t.data[f+2],r>95&&a>40&&i>20&&r>a&&r>i&&r-Math.min(a,i)>15&&Math.abs(r-a)>15?e[o]=255:e[o]=0}}]),t}(),v=function(){function t(){a(this,t)}return f(t,[{key:"identity",value:function(t,e){void 0===e&&(e=1);for(var r=t.data,a=t.rows,i=t.cols,f=i+1|0,o=a*i,n=o;--o>=0;)r[o]=0;for(o=n,n=0;n<o;)r[n]=e,n+=f}},{key:"transpose",value:function(t,e){for(var r=0,a=0,i=e.rows,f=e.cols,o=0,n=0,s=0,h=e.data,u=t.data;r<i;n+=1,o+=f,r++)for(s=n,a=0;a<f;s+=i,a++)u[s]=h[o+a]}},{key:"multiply",value:function(t,e,r){for(var a=0,i=0,f=0,o=0,n=0,s=0,h=0,u=0,c=e.cols,_=e.rows,d=r.cols,l=e.data,b=r.data,v=t.data,p=0;a<_;o+=c,a++)for(h=0,i=0;i<d;u++,h++,i++){for(s=h,n=o,p=0,f=0;f<c;n++,s+=d,f++)p+=l[n]*b[s];v[u]=p}}},{key:"multiply_ABt",value:function(t,e,r){for(var a=0,i=0,f=0,o=0,n=0,s=0,h=0,u=e.cols,c=e.rows,_=r.rows,d=e.data,l=r.data,b=t.data,v=0;a<c;o+=u,a++)for(s=0,i=0;i<_;h++,i++){for(n=o,v=0,f=0;f<u;n++,s++,f++)v+=d[n]*l[s];b[h]=v}}},{key:"multiply_AtB",value:function(t,e,r){for(var a=0,i=0,f=0,o=0,n=0,s=0,h=0,u=0,c=e.cols,_=e.rows,d=r.cols,l=e.data,b=r.data,v=t.data,p=0;a<c;o++,a++)for(h=0,i=0;i<d;u++,h++,i++){for(s=h,n=o,p=0,f=0;f<_;n+=c,s+=d,f++)p+=l[n]*b[s];v[u]=p}}},{key:"multiply_AAt",value:function(t,e){for(var r=0,a=0,i=0,f=0,o=0,n=0,s=0,h=0,u=0,c=e.cols,_=e.rows,d=e.data,l=t.data,b=0;r<_;f+=_+1,o=n,r++)for(h=f,u=f,s=o,a=r;a<_;h++,u+=_,a++){for(n=o,b=0,i=0;i<c;i++)b+=d[n++]*d[s++];l[h]=b,l[u]=b}}},{key:"multiply_AtA",value:function(t,e){for(var r=0,a=0,i=0,f=0,o=0,n=0,s=0,h=0,u=0,c=e.cols,_=e.rows,d=e.data,l=t.data,b=0;r<c;s+=c,r++)for(f=r,h=u=s+r,a=r;a<c;h++,u+=c,a++){for(o=f,n=a,b=0,i=0;i<_;o+=c,n+=c,i++)b+=d[o]*d[n];l[h]=b,l[u]=b}}},{key:"identity_3x3",value:function(t,e){void 0===e&&(e=1);var r=t.data;r[0]=r[4]=r[8]=e,r[1]=r[2]=r[3]=0,r[5]=r[6]=r[7]=0}},{key:"invert_3x3",value:function(t,e){var r=t.data,a=e.data,i=r[4],f=r[8],o=r[5],n=r[7],s=r[0],h=s*i,u=s*o,c=r[3],_=r[1],d=c*_,l=r[2],b=c*l,v=r[6],p=v*_,y=v*l,w=1/(h*f-u*n-d*f+b*n+p*o-y*i);a[0]=(i*f-o*n)*w,a[1]=-(_*f-l*n)*w,a[2]=-(-_*o+l*i)*w,a[3]=-(c*f-o*v)*w,a[4]=(s*f-y)*w,a[5]=-(u-b)*w,a[6]=-(-c*n+i*v)*w,a[7]=-(s*n-p)*w,a[8]=(h-d)*w}},{key:"multiply_3x3",value:function(t,e,r){var a=t.data,i=e.data,f=r.data,o=i[0],n=i[1],s=i[2],h=i[3],u=i[4],c=i[5],_=i[6],d=i[7],l=i[8],b=f[0],v=f[1],p=f[2],y=f[3],w=f[4],m=f[5],k=f[6],M=f[7],g=f[8];a[0]=o*b+n*y+s*k,a[1]=o*v+n*w+s*M,a[2]=o*p+n*m+s*g,a[3]=h*b+u*y+c*k,a[4]=h*v+u*w+c*M,a[5]=h*p+u*m+c*g,a[6]=_*b+d*y+l*k,a[7]=_*v+d*w+l*M,a[8]=_*p+d*m+l*g}},{key:"mat3x3_determinant",value:function(t){var e=t.data;return e[0]*e[4]*e[8]-e[0]*e[5]*e[7]-e[3]*e[1]*e[8]+e[3]*e[2]*e[7]+e[6]*e[1]*e[5]-e[6]*e[2]*e[4]}},{key:"determinant_3x3",value:function(t,e,r,a,i,f,o,n,s){return t*i*s-t*f*n-a*e*s+a*r*n+o*e*f-o*r*i}}]),t}(),p=function(){function t(e){a(this,t),this.levels=0|e,this.data=new Array(e);var r=new b;this.pyrdown=r.pyrdown}return f(t,[{key:"allocate",value:function(t,e,r){for(var a=this.levels;--a>=0;)this.data[a]=new l(t>>a,e>>a,r)}},{key:"build",value:function(t,e){void 0===e&&(e=!0);var r=2,a=t,i=this.data[0];if(!e)for(var f=t.cols*t.rows;--f>=0;)i.data[f]=t.data[f];for(i=this.data[1],this.pyrdown(a,i);r<this.levels;++r)a=i,i=this.data[r],this.pyrdown(a,i)}}]),t}();function y(t,e,r,a){a=t[e],t[e]=t[r],t[r]=a}function w(t,e){return(t=Math.abs(t))>(e=Math.abs(e))?(e/=t,t*Math.sqrt(1+e*e)):e>0?(t/=e,e*Math.sqrt(1+t*t)):0}var m=function(){function t(){a(this,t),this.cache=new u,this.cache.allocate(30,2560),this.matmath=new v}return f(t,[{key:"JacobiImpl",value:function(t,e,r,a,i,f){var o=_.EPSILON,n=0,s=0,h=0,u=0,c=0,d=0,l=0,b=0,v=0,p=f*f*30,m=0,k=0,M=0,g=0,x=0,O=0,C=0,R=0,S=0,A=this.cache.get_buffer(f<<2),L=this.cache.get_buffer(f<<2),z=A.i32,G=L.i32;if(a)for(;n<f;n++){for(h=n*i,s=0;s<f;s++)a[h+s]=0;a[h+n]=1}for(h=0;h<f;h++){if(r[h]=t[(e+1)*h],h<f-1){for(u=h+1,m=Math.abs(t[e*h+u]),n=h+2;n<f;n++)m<(k=Math.abs(t[e*h+n]))&&(m=k,u=n);z[h]=u}if(h>0){for(u=0,m=Math.abs(t[h]),n=1;n<h;n++)m<(k=Math.abs(t[e*n+h]))&&(m=k,u=n);G[h]=u}}if(f>1)for(;v<p;v++){for(h=0,m=Math.abs(t[z[0]]),n=1;n<f-1;n++)m<(k=Math.abs(t[e*n+z[n]]))&&(m=k,h=n);for(c=z[h],n=1;n<f;n++)m<(k=Math.abs(t[e*G[n]+n]))&&(m=k,h=G[n],c=n);if(M=t[e*h+c],Math.abs(M)<=o)break;for(g=.5*(r[c]-r[h]),C=(x=Math.abs(g)+w(M,g))/(O=w(M,x)),O=M/O,x=M/x*M,g<0&&(O=-O,x=-x),t[e*h+c]=0,r[h]-=x,r[c]+=x,n=0;n<h;n++)b=e*n+c,R=t[l=e*n+h],S=t[b],t[l]=R*C-S*O,t[b]=R*O+S*C;for(n=h+1;n<c;n++)b=e*n+c,R=t[l=e*h+n],S=t[b],t[l]=R*C-S*O,t[b]=R*O+S*C;for(l=e*h+(n=c+1),b=e*c+n;n<f;n++,l++,b++)R=t[l],S=t[b],t[l]=R*C-S*O,t[b]=R*O+S*C;if(a)for(l=i*h,b=i*c,n=0;n<f;n++,l++,b++)R=a[l],S=a[b],a[l]=R*C-S*O,a[b]=R*O+S*C;for(s=0;s<2;s++){if((d=0==s?h:c)<f-1){for(u=d+1,m=Math.abs(t[e*d+u]),n=d+2;n<f;n++)m<(k=Math.abs(t[e*d+n]))&&(m=k,u=n);z[d]=u}if(d>0){for(u=0,m=Math.abs(t[d]),n=1;n<d;n++)m<(k=Math.abs(t[e*n+d]))&&(m=k,u=n);G[d]=u}}}for(h=0;h<f-1;h++){for(u=h,n=h+1;n<f;n++)r[u]<r[n]&&(u=n);if(h!=u&&(y(r,u,h,m),a))for(n=0;n<f;n++)y(a,i*u+n,i*h+n,m)}this.cache.put_buffer(A),this.cache.put_buffer(L)}},{key:"JacobiSVDImpl",value:function(t,e,r,a,i,f,o,n){for(var s=2*_.EPSILON,h=_.FLT_MIN,u=0,c=0,d=0,l=0,b=Math.max(f,30),v=0,p=0,m=0,k=0,M=0,g=0,x=0,O=0,C=0,R=0,S=0,A=0,L=0,z=0,G=0,U=0,B=0,I=4660,F=0,P=0,T=0,q=this.cache.get_buffer(o<<3),E=q.f64;u<o;u++){for(d=0,S=0;d<f;d++)S+=(O=t[u*e+d])*O;if(E[u]=S,a){for(d=0;d<o;d++)a[u*i+d]=0;a[u*i+u]=1}}for(;l<b;l++){for(M=0,u=0;u<o-1;u++)for(c=u+1;c<o;c++){for(v=u*e|0,p=c*e|0,G=E[u],U=0,B=E[c],d=2,U+=t[v]*t[p],U+=t[v+1]*t[p+1];d<f;d++)U+=t[v+d]*t[p+d];if(!(Math.abs(U)<=s*Math.sqrt(G*B))){for(L=w(U*=2,A=G-B),A<0?(z=.5*(L-A),g=U/(L*(x=Math.sqrt(z/L))*2)):x=U/(L*(g=Math.sqrt((L+A)/(2*L)))*2),G=0,B=0,d=2,C=g*t[v]+x*t[p],R=-x*t[v]+g*t[p],t[v]=C,t[p]=R,G+=C*C,B+=R*R,C=g*t[v+1]+x*t[p+1],R=-x*t[v+1]+g*t[p+1],t[v+1]=C,t[p+1]=R,G+=C*C,B+=R*R;d<f;d++)C=g*t[v+d]+x*t[p+d],R=-x*t[v+d]+g*t[p+d],t[v+d]=C,t[p+d]=R,G+=C*C,B+=R*R;if(E[u]=G,E[c]=B,M=1,a)for(k=c*i|0,d=2,C=g*a[m=u*i|0]+x*a[k],R=-x*a[m]+g*a[k],a[m]=C,a[k]=R,C=g*a[m+1]+x*a[k+1],R=-x*a[m+1]+g*a[k+1],a[m+1]=C,a[k+1]=R;d<o;d++)C=g*a[m+d]+x*a[k+d],R=-x*a[m+d]+g*a[k+d],a[m+d]=C,a[k+d]=R}}if(0==M)break}for(u=0;u<o;u++){for(d=0,S=0;d<f;d++)S+=(O=t[u*e+d])*O;E[u]=Math.sqrt(S)}for(u=0;u<o-1;u++){for(c=u,d=u+1;d<o;d++)E[c]<E[d]&&(c=d);if(u!=c&&(y(E,u,c,S),a)){for(d=0;d<f;d++)y(t,u*e+d,c*e+d,O);for(d=0;d<o;d++)y(a,u*i+d,c*i+d,O)}}for(u=0;u<o;u++)r[u]=E[u];if(a){for(u=0;u<n;u++){for(S=u<o?E[u]:0;S<=h;){for(P=1/f,d=0;d<f;d++)F=0!=(256&(I=214013*I+2531011)>>16)?P:-P,t[u*e+d]=F;for(l=0;l<2;l++)for(c=0;c<u;c++){for(S=0,d=0;d<f;d++)S+=t[u*e+d]*t[c*e+d];for(T=0,d=0;d<f;d++)O=t[u*e+d]-S*t[c*e+d],t[u*e+d]=O,T+=Math.abs(O);for(T=T?1/T:0,d=0;d<f;d++)t[u*e+d]*=T}for(S=0,d=0;d<f;d++)S+=(O=t[u*e+d])*O;S=Math.sqrt(S)}for(x=1/S,d=0;d<f;d++)t[u*e+d]*=x}this.cache.put_buffer(q)}else this.cache.put_buffer(q)}},{key:"lu_solve",value:function(t,e){var r,a,i,f,o=0,n=0,s=0,h=1,u=t.cols,c=t.data,d=e.data;for(o=0;o<u;o++){for(s=o,n=o+1;n<u;n++)Math.abs(c[n*u+o])>Math.abs(c[s*u+o])&&(s=n);if(Math.abs(c[s*u+o])<_.EPSILON)return 0;if(s!=o){for(n=o;n<u;n++)y(c,o*u+n,s*u+n,r);y(d,o,s,r),h=-h}for(i=-1/c[o*u+o],n=o+1;n<u;n++){for(a=c[n*u+o]*i,s=o+1;s<u;s++)c[n*u+s]+=a*c[o*u+s];d[n]+=a*d[o]}c[o*u+o]=-i}for(o=u-1;o>=0;o--){for(f=d[o],s=o+1;s<u;s++)f-=c[o*u+s]*d[s];d[o]=f*c[o*u+o]}return 1}},{key:"cholesky_solve",value:function(t,e){var r,a,i=0,f=0,o=0,n=0,s=0,h=0,u=0,c=t.cols,_=t.data,d=e.data;for(i=0;i<c;i++)for(a=1,s=n=i*c,f=i;f<c;f++){for(r=_[s+i],o=0;o<i;o++)r-=_[o*c+i]*_[s+o];if(f==i){if(_[s+i]=r,0==r)return 0;a=1/r}else _[n+f]=r,_[s+i]=r*a;s+=c}for(n=0,h=0;h<c;h++){for(r=d[h],u=0;u<h;u++)r-=_[n+u]*d[u];d[h]=r,n+=c}for(n=0,h=0;h<c;h++)d[h]/=_[n+h],n+=c;for(h=c-1;h>=0;h--){for(r=d[h],n=(u=h+1)*c;u<c;u++)r-=_[n+h]*d[u],n+=c;d[h]=r}return 1}},{key:"svd_decompose",value:function(t,e,r,a,i){void 0===i&&(i=0);var f=0,o=0,n=t.rows,s=t.cols,h=n,u=s,c=t.type|_.C1_t;h<u&&(f=1,o=h,h=u,u=o);var d=this.cache.get_buffer(h*h<<3),b=this.cache.get_buffer(u<<3),v=this.cache.get_buffer(u*u<<3),p=new l(h,h,c,d.data),y=new l(1,u,c,b.data),w=new l(u,u,c,v.data);if(0==f)this.matmath.transpose(p,t);else{for(o=0;o<s*n;o++)p.data[o]=t.data[o];for(;o<u*h;o++)p.data[o]=0}if(this.JacobiSVDImpl(p.data,h,y.data,w.data,u,h,u,h),e){for(o=0;o<u;o++)e.data[o]=y.data[o];for(;o<s;o++)e.data[o]=0}if(0==f){if(r&&i&_.SVD_U_T)for(o=h*h;--o>=0;)r.data[o]=p.data[o];else r&&this.matmath.transpose(r,p);if(a&&i&_.SVD_V_T)for(o=u*u;--o>=0;)a.data[o]=w.data[o];else a&&this.matmath.transpose(a,w)}else{if(r&&i&_.SVD_U_T)for(o=u*u;--o>=0;)r.data[o]=w.data[o];else r&&this.matmath.transpose(r,w);if(a&&i&_.SVD_V_T)for(o=h*h;--o>=0;)a.data[o]=p.data[o];else a&&this.matmath.transpose(a,p)}this.cache.put_buffer(d),this.cache.put_buffer(b),this.cache.put_buffer(v)}},{key:"svd_solve",value:function(t,e,r){var a,i=0,f=0,o=0,n=0,s=0,h=t.rows,u=t.cols,c=0,d=0,b=t.type|_.C1_t,v=this.cache.get_buffer(h*h<<3),p=this.cache.get_buffer(u<<3),y=this.cache.get_buffer(u*u<<3),w=new l(h,h,b,v.data),m=new l(1,u,b,p.data),k=new l(u,u,b,y.data),M=r.data,g=w.data,x=m.data,O=k.data;for(this.svd_decompose(t,m,w,k,0),a=_.EPSILON*x[0]*u;i<u;i++,s+=u){for(d=0,f=0;f<u;f++)if(x[f]>a){for(o=0,c=0,n=0;o<h;o++,n+=u)c+=g[n+f]*M[o];d+=c*O[s+f]/x[f]}e.data[i]=d}this.cache.put_buffer(v),this.cache.put_buffer(p),this.cache.put_buffer(y)}},{key:"svd_invert",value:function(t,e){var r,a=0,i=0,f=0,o=0,n=0,s=0,h=e.rows,u=e.cols,c=0,d=e.type|_.C1_t,b=this.cache.get_buffer(h*h<<3),v=this.cache.get_buffer(u<<3),p=this.cache.get_buffer(u*u<<3),y=new l(h,h,d,b.data),w=new l(1,u,d,v.data),m=new l(u,u,d,p.data),k=t.data,M=y.data,g=w.data,x=m.data;for(this.svd_decompose(e,w,y,m,0),r=_.EPSILON*g[0]*u;a<u;a++,n+=u)for(i=0,o=0;i<h;i++,s++){for(f=0,c=0;f<u;f++,o++)g[f]>r&&(c+=x[n+f]*M[o]/g[f]);k[s]=c}this.cache.put_buffer(b),this.cache.put_buffer(v),this.cache.put_buffer(p)}},{key:"eigenVV",value:function(t,e,r){for(var a=t.cols,i=a*a,f=t.type|_.C1_t,o=this.cache.get_buffer(a*a<<3),n=this.cache.get_buffer(a<<3),s=new l(a,a,f,o.data),h=new l(1,a,f,n.data);--i>=0;)s.data[i]=t.data[i];if(this.JacobiImpl(s.data,a,h.data,e?e.data:null,a,a),r)for(;--a>=0;)r.data[a]=h.data[a];this.cache.put_buffer(o),this.cache.put_buffer(n)}}]),t}();function k(t,e,r,a,i,f,o){var n=Math.cos(r),s=Math.sin(r),h=new b;o.data[0]=n,o.data[1]=-s,o.data[2]=(-n+s)*f*.5+a,o.data[3]=s,o.data[4]=n,o.data[5]=(-s-n)*f*.5+i,h.warp_affine(t,e,o,128)}var M=function(){function t(){a(this,t),this.bit_pattern_31_=new Int32Array(r.default),this.H=new l(3,3,_.F32_t|_.C1_t),this.patch_img=new l(32,32,_.U8_t|_.C1_t)}return f(t,[{key:"describe",value:function(t,e,r,a){var i=0,f=0,o=0,n=0,s=0,h=0,u=0,c=0,d=(t.data,t.cols,t.rows,this.patch_img.data),l=528,b=0;a.type&_.U8_t?a.resize(32,r,1):(a.type=_.U8_t,a.cols=32,a.rows=r,a.channel=1,a.allocate());var v=a.data,p=0;for(i=0;i<r;++i){for(o=e[i].x,n=e[i].y,s=e[i].angle,k(t,this.patch_img,s,o,n,32,this.H),b=0,f=0;f<32;++f)h=d[l+32*this.bit_pattern_31_[b+1]+this.bit_pattern_31_[b]],b+=2,u=d[l+32*this.bit_pattern_31_[b+1]+this.bit_pattern_31_[b]],b+=2,c=h<u|0,h=d[l+32*this.bit_pattern_31_[b+1]+this.bit_pattern_31_[b]],b+=2,u=d[l+32*this.bit_pattern_31_[b+1]+this.bit_pattern_31_[b]],b+=2,c|=(h<u)<<1,h=d[l+32*this.bit_pattern_31_[b+1]+this.bit_pattern_31_[b]],b+=2,u=d[l+32*this.bit_pattern_31_[b+1]+this.bit_pattern_31_[b]],b+=2,c|=(h<u)<<2,h=d[l+32*this.bit_pattern_31_[b+1]+this.bit_pattern_31_[b]],b+=2,u=d[l+32*this.bit_pattern_31_[b+1]+this.bit_pattern_31_[b]],b+=2,c|=(h<u)<<3,h=d[l+32*this.bit_pattern_31_[b+1]+this.bit_pattern_31_[b]],b+=2,u=d[l+32*this.bit_pattern_31_[b+1]+this.bit_pattern_31_[b]],b+=2,c|=(h<u)<<4,h=d[l+32*this.bit_pattern_31_[b+1]+this.bit_pattern_31_[b]],b+=2,u=d[l+32*this.bit_pattern_31_[b+1]+this.bit_pattern_31_[b]],b+=2,c|=(h<u)<<5,h=d[l+32*this.bit_pattern_31_[b+1]+this.bit_pattern_31_[b]],b+=2,u=d[l+32*this.bit_pattern_31_[b+1]+this.bit_pattern_31_[b]],b+=2,c|=(h<u)<<6,h=d[l+32*this.bit_pattern_31_[b+1]+this.bit_pattern_31_[b]],b+=2,u=d[l+32*this.bit_pattern_31_[b+1]+this.bit_pattern_31_[b]],b+=2,c|=(h<u)<<7,v[p+f]=c;p+=32}}}]),t}();function g(t,e,r,a,i){var f,o;if(r>0)for(e-=a*i,o=-i;o<=i;++o){for(f=-i;f<=i;++f)if(t[e+f]>r)return!1;e+=a}else for(e-=a*i,o=-i;o<=i;++o){for(f=-i;f<=i;++f)if(t[e+f]<r)return!1;e+=a}return!0}function x(t,e,r,a,i,f,o,n){var s=0,h=0,u=o-1|0,c=0,_=0,d=0,l=0,b=0;if((c=t[e+f[h]])<=i)if(c>=a)if((_=t[e+f[u]])<=i){if(_>=a)return void(r[e]=0);if((d=t[e+f[++u]])>i)if((l=t[e+f[++u]])>i)b=3;else{if(!(l<a))return void(r[e]=0);b=6}else if((l=t[e+f[++u]])>i)b=7;else{if(!(l<a))return void(r[e]=0);b=2}}else if((d=t[e+f[++u]])>i)if((l=t[e+f[++u]])>i)b=3;else{if(!(l<a))return void(r[e]=0);b=6}else{if(!(d<a))return void(r[e]=0);if((l=t[e+f[++u]])>i)b=7;else{if(!(l<a))return void(r[e]=0);b=2}}else{if((_=t[e+f[u]])>i)return void(r[e]=0);if((d=t[e+f[++u]])>i)return void(r[e]=0);if((l=t[e+f[++u]])>i)return void(r[e]=0);b=1}else{if((_=t[e+f[u]])<a)return void(r[e]=0);if((d=t[e+f[++u]])<a)return void(r[e]=0);if((l=t[e+f[++u]])<a)return void(r[e]=0);b=0}for(h=1;h<=o;h++)switch(c=t[e+f[h]],b){case 0:if(c>i){if(d=l,(l=t[e+f[++u]])<a)return void(r[e]=0);s-=c+d,b=0;break}if(c<a){if(d>i)return void(r[e]=0);if(l>i)return void(r[e]=0);if(d=l,(l=t[e+f[++u]])>i)return void(r[e]=0);s-=c+d,b=8;break}if(d<=i)return void(r[e]=0);if(l<=i)return void(r[e]=0);if(d=l,(l=t[e+f[++u]])>i){s-=c+d,b=3;break}if(l<a){s-=c+d,b=6;break}return void(r[e]=0);case 1:if(c<a){if(d=l,(l=t[e+f[++u]])>i)return void(r[e]=0);s-=c+d,b=1;break}if(c>i){if(d<a)return void(r[e]=0);if(l<a)return void(r[e]=0);if(d=l,(l=t[e+f[++u]])<a)return void(r[e]=0);s-=c+d,b=9;break}if(d>=a)return void(r[e]=0);if(l>=a)return void(r[e]=0);if(d=l,(l=t[e+f[++u]])<a){s-=c+d,b=2;break}if(l>i){s-=c+d,b=7;break}return void(r[e]=0);case 2:if(c>i)return void(r[e]=0);if(d=l,l=t[e+f[++u]],c<a){if(l>i)return void(r[e]=0);s-=c+d,b=4;break}if(l>i){s-=c+d,b=7;break}if(l<a){s-=c+d,b=2;break}return void(r[e]=0);case 3:if(c<a)return void(r[e]=0);if(d=l,l=t[e+f[++u]],c>i){if(l<a)return void(r[e]=0);s-=c+d,b=5;break}if(l>i){s-=c+d,b=3;break}if(l<a){s-=c+d,b=6;break}return void(r[e]=0);case 4:if(c>i)return void(r[e]=0);if(c<a){if(d=l,(l=t[e+f[++u]])>i)return void(r[e]=0);s-=c+d,b=1;break}if(l>=a)return void(r[e]=0);if(d=l,(l=t[e+f[++u]])<a){s-=c+d,b=2;break}if(l>i){s-=c+d,b=7;break}return void(r[e]=0);case 5:if(c<a)return void(r[e]=0);if(c>i){if(d=l,(l=t[e+f[++u]])<a)return void(r[e]=0);s-=c+d,b=0;break}if(l<=i)return void(r[e]=0);if(d=l,(l=t[e+f[++u]])>i){s-=c+d,b=3;break}if(l<a){s-=c+d,b=6;break}return void(r[e]=0);case 7:if(c>i)return void(r[e]=0);if(c<a)return void(r[e]=0);if(d=l,(l=t[e+f[++u]])>i){s-=c+d,b=3;break}if(l<a){s-=c+d,b=6;break}return void(r[e]=0);case 6:if(c>i)return void(r[e]=0);if(c<a)return void(r[e]=0);if(d=l,(l=t[e+f[++u]])<a){s-=c+d,b=2;break}if(l>i){s-=c+d,b=7;break}return void(r[e]=0);case 8:if(c>i){if(l<a)return void(r[e]=0);if(d=l,(l=t[e+f[++u]])<a)return void(r[e]=0);s-=c+d,b=9;break}if(c<a){if(d=l,(l=t[e+f[++u]])>i)return void(r[e]=0);s-=c+d,b=1;break}return void(r[e]=0);case 9:if(c<a){if(l>i)return void(r[e]=0);if(d=l,(l=t[e+f[++u]])>i)return void(r[e]=0);s-=c+d,b=8;break}if(c>i){if(d=l,(l=t[e+f[++u]])<a)return void(r[e]=0);s-=c+d,b=0;break}return void(r[e]=0)}r[e]=s+n*t[e]}var O=f((function t(e,r,i){a(this,t),this.dirs=new Int32Array(1024),this.dirs_count=0|function(t,e,r){var a,i,f=0;for(a=r,i=0;i<a;i++,f++)a=Math.sqrt(r*r-i*i)+.5|0,e[f]=a+t*i;for(a--;a<i&&a>=0;a--,f++)i=Math.sqrt(r*r-a*a)+.5|0,e[f]=a+t*i;for(;-a<i;a--,f++)i=Math.sqrt(r*r-a*a)+.5|0,e[f]=a+t*i;for(i--;i>=0;i--,f++)a=-Math.sqrt(r*r-i*i)-.5|0,e[f]=a+t*i;for(;i>a;i--,f++)a=-Math.sqrt(r*r-i*i)-.5|0,e[f]=a+t*i;for(a++;a<=0;a++,f++)i=-Math.sqrt(r*r-a*a)-.5|0,e[f]=a+t*i;for(;a<-i;a++,f++)i=-Math.sqrt(r*r-a*a)-.5|0,e[f]=a+t*i;for(i++;i<0;i++,f++)a=Math.sqrt(r*r-i*i)+.5|0,e[f]=a+t*i;return e[f]=e[0],e[f+1]=e[1],f}(e,this.dirs,i),this.scores=new Int32Array(e*r),this.radius=0|i})),C=function(){function t(){a(this,t),this.level_tables=[],this.tau=7}return f(t,[{key:"init",value:function(t,e,r,a){var i;for(void 0===a&&(a=1),r=Math.min(r,7),r=Math.max(r,3),i=0;i<a;++i)this.level_tables[i]=new O(t>>i,e>>i,r)}},{key:"detect",value:function(t,e,r){void 0===r&&(r=4);var a,i,f,o,n,s=this.level_tables[0],h=0|s.radius,u=h-1|0,c=s.dirs,_=0|s.dirs_count,d=_>>1,l=t.data,b=0|t.cols,v=0|t.rows,p=b>>1,y=s.scores,w=0,m=0,k=0,M=0,O=0,C=0,R=0,S=0,A=0|this.tau,L=0,z=0|Math.max(h+1,r),G=0|Math.max(h+1,r),U=0|Math.min(b-h-2,b-r),B=0|Math.min(v-h-2,v-r);for(k=G*b+z|0,m=G;m<B;++m,k+=b)for(w=z,M=k;w<U;++w,++M)O=l[M]+A,(C=l[M]-A)<l[M+h]&&l[M+h]<O&&C<l[M-h]&&l[M-h]<O?y[M]=0:x(l,M,y,C,O,c,d,_);for(k=G*b+z|0,m=G;m<B;++m,k+=b)for(w=z,M=k;w<U;++w,++M)S=y[M],(R=Math.abs(S))<5?(++w,++M):(o=b,n=void 0,n=0,0!=(i=y)[(f=M)+1]&&n++,0!=i[f-1]&&n++,0!=i[f+o]&&n++,0!=i[f+o+1]&&n++,0!=i[f+o-1]&&n++,0!=i[f-o]&&n++,0!=i[f-o+1]&&n++,0!=i[f-o-1]&&n++,n>=3&&g(y,M,S,p,h)&&((a=e[L]).x=w,a.y=m,a.score=R,++L,w+=u,M+=u));return L}}]),t}();function R(t,e,r,a,i,f,o){var n=-2*t[e]+t[e+a]+t[e-a],s=-2*t[e]+t[e+i]+t[e-i],h=t[e+f]+t[e-f]-t[e+o]-t[e-o],u=0|Math.sqrt((n-s)*(n-s)+4*h*h);return Math.min(Math.abs(r-u),Math.abs(-(r+u)))}var S=function(){function t(){a(this,t),this.cache=new u,this.cache.allocate(30,2560),this.laplacian_threshold=30,this.min_eigen_value_threshold=25}return f(t,[{key:"detect",value:function(t,e,r){void 0===r&&(r=5);var a,i=0,f=0,o=t.cols,n=t.rows,s=t.data,h=5*o|0,u=3+3*o|0,c=3-3*o|0,_=this.cache.get_buffer(o*n<<2),d=_.i32,l=0,b=0,v=0,p=0,y=0,w=this.laplacian_threshold,m=this.min_eigen_value_threshold,k=0|Math.max(5,r),M=0|Math.max(3,r),g=0|Math.min(o-5,o-r),x=0|Math.min(n-3,n-r);for(i=o*n;--i>=0;)d[i]=0;for(function(t,e,r,a,i,f,o,n,s,h){var u=0,c=0,_=n*r+o|0,d=_;for(u=n;u<h;++u,d=_+=r)for(c=o;c<s;++c,++d)e[d]=-4*t[d]+t[d+5]+t[d-5]+t[d+f]+t[d-f]}(s,d,o,0,0,h,k,M,g,x),b=M*o+k|0,f=M;f<x;++f,b+=o)for(i=k,v=b;i<g;++i,++v)((l=d[v])<-w&&l<d[v-1]&&l<d[v+1]&&l<d[v-o]&&l<d[v+o]&&l<d[v-o-1]&&l<d[v+o-1]&&l<d[v-o+1]&&l<d[v+o+1]||l>w&&l>d[v-1]&&l>d[v+1]&&l>d[v-o]&&l>d[v+o]&&l>d[v-o-1]&&l>d[v+o-1]&&l>d[v-o+1]&&l>d[v+o+1])&&(p=R(s,v,l,5,h,u,c))>m&&((a=e[y]).x=i,a.y=f,a.score=p,++y,++i,++v);return this.cache.put_buffer(_),y}}]),t}(),A=function(){function t(){a(this,t),this.cache=new u,this.cache.allocate(30,2560)}return f(t,[{key:"get_subset",value:function(t,e,r,a,i,f,o){for(var n=1e3,s=[],h=0,u=0,c=0,_=0,d=!1;c<n;++c){for(h=0;h<a&&c<n;){for(d=!1,_=0;!d;)for(d=!0,_=s[h]=0|Math.floor(Math.random()*i),u=0;u<h;++u)if(_==s[u]){d=!1;break}f[h]=e[_],o[h]=r[_],t.check_subset(f,o,h+1)?++h:c++}break}return h==a&&c<n}},{key:"find_inliers",value:function(t,e,r,a,i,f,o,n){var s=0,h=0,u=0,c=f*f;for(t.error(r,a,e,o,i);h<i;++h)u=o[h]<=c,n[h]=u,s+=u;return s}},{key:"ransac",value:function(t,e,r,a,i,f,o,n){if(void 0===n&&(n=1e3),i<t.size)return!1;var s=t.size,h=n,u=0,c=!1,d=[],b=[],v=f.cols,p=f.rows,y=f.type|_.C1_t,w=this.cache.get_buffer(v*p<<3),m=this.cache.get_buffer(i),k=this.cache.get_buffer(i<<2),M=new l(v,p,y,w.data),g=new l(i,1,_.U8C1_t,m.data),x=-1,O=0,C=k.f32;if(i==s){if(e.run(r,a,M,i)<=0)return this.cache.put_buffer(w),this.cache.put_buffer(m),this.cache.put_buffer(k),!1;if(M.copy_to(f),o)for(;--i>=0;)o.data[i]=1;return this.cache.put_buffer(w),this.cache.put_buffer(m),this.cache.put_buffer(k),!0}for(;u<h;++u){if(!this.get_subset(e,r,a,s,i,d,b)){if(0==u)return this.cache.put_buffer(w),this.cache.put_buffer(m),this.cache.put_buffer(k),!1;break}e.run(d,b,M,s)<=0||(O=this.find_inliers(e,M,r,a,i,t.thresh,C,g.data))>Math.max(x,s-1)&&(M.copy_to(f),x=O,o&&g.copy_to(o),h=t.update_iters((i-O)/i,h),c=!0)}return this.cache.put_buffer(w),this.cache.put_buffer(m),this.cache.put_buffer(k),c}},{key:"lmeds",value:function(t,e,r,a,i,f,o,n){if(void 0===n&&(n=1e3),i<t.size)return!1;var s=t.size,h=n,u=0,c=!1,b=new d,v=[],p=[],y=f.cols,w=f.rows,m=f.type|_.C1_t,k=this.cache.get_buffer(y*w<<3),M=this.cache.get_buffer(i),g=this.cache.get_buffer(i<<2),x=new l(y,w,m,k.data),O=new l(i,1,_.U8_t|_.C1_t,M.data),C=0,R=g.f32,S=1e9,A=0,L=0;if(t.eps=.45,h=t.update_iters(t.eps,h),i==s){if(e.run(r,a,x,i)<=0)return this.cache.put_buffer(k),this.cache.put_buffer(M),this.cache.put_buffer(g),!1;if(x.copy_to(f),o)for(;--i>=0;)o.data[i]=1;return this.cache.put_buffer(k),this.cache.put_buffer(M),this.cache.put_buffer(g),!0}for(;u<h;++u){if(!this.get_subset(e,r,a,s,i,v,p)){if(0==u)return this.cache.put_buffer(k),this.cache.put_buffer(M),this.cache.put_buffer(g),!1;break}e.run(v,p,x,s)<=0||(e.error(r,a,x,R,i),(L=b.median(R,0,i-1))<S&&(S=L,x.copy_to(f),c=!0))}return c&&(A=2.5*1.4826*(1+5/(i-s))*Math.sqrt(S),A=Math.max(A,.001),C=this.find_inliers(e,f,r,a,i,A,R,O.data),o&&O.copy_to(o),c=C>=s),this.cache.put_buffer(k),this.cache.put_buffer(M),this.cache.put_buffer(g),c}}]),t}();function L(t,e){return L=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(t,e){return t.__proto__=e,t},L(t,e)}function z(t){return z="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},z(t)}function G(t,e){if(e&&("object"===z(e)||"function"==typeof e))return e;if(void 0!==e)throw new TypeError("Derived constructors may only return object or undefined");return function(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}(t)}function U(t){return U=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(t){return t.__proto__||Object.getPrototypeOf(t)},U(t)}var B=function(t){!function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),Object.defineProperty(t,"prototype",{writable:!1}),e&&L(t,e)}(o,t);var e,r,i=(e=o,r=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(t){return!1}}(),function(){var t,a=U(e);if(r){var i=U(this).constructor;t=Reflect.construct(a,arguments,i)}else t=a.apply(this,arguments);return G(this,t)});function o(){var t;return a(this,o),(t=i.call(this)).mLtL=new l(9,9,_.F32_t|_.C1_t),t.Evec=new l(9,9,_.F32_t|_.C1_t),t}return f(o,[{key:"run",value:function(t,e,r,a){for(var i=0,f=0,o=r.data,n=this.T0.data,s=this.T1.data,h=this.mLtL.data,u=this.Evec.data,c=0,d=0,l=0,b=0,p=new m,y=new v,w=0,k=0,M=0,g=0,x=0,O=0,C=0,R=0;i<a;++i)M+=e[i].x,g+=e[i].y,C+=t[i].x,R+=t[i].y;for(M/=a,g/=a,C/=a,R/=a,i=0;i<a;++i)w+=Math.abs(e[i].x-M),k+=Math.abs(e[i].y-g),x+=Math.abs(t[i].x-C),O+=Math.abs(t[i].y-R);if(Math.abs(w)<_.EPSILON||Math.abs(k)<_.EPSILON||Math.abs(x)<_.EPSILON||Math.abs(O)<_.EPSILON)return 0;for(w=a/w,k=a/k,x=a/x,O=a/O,n[0]=x,n[1]=0,n[2]=-C*x,n[3]=0,n[4]=O,n[5]=-R*O,n[6]=0,n[7]=0,n[8]=1,s[0]=1/w,s[1]=0,s[2]=M,s[3]=0,s[4]=1/k,s[5]=g,s[6]=0,s[7]=0,s[8]=1,i=81;--i>=0;)h[i]=0;for(i=0;i<a;++i)c=(e[i].x-M)*w,d=(e[i].y-g)*k,l=(t[i].x-C)*x,b=(t[i].y-R)*O,h[0]+=l*l,h[1]+=l*b,h[2]+=l,h[6]+=l*-c*l,h[7]+=l*-c*b,h[8]+=l*-c,h[10]+=b*b,h[11]+=b,h[15]+=b*-c*l,h[16]+=b*-c*b,h[17]+=b*-c,h[20]+=1,h[24]+=-c*l,h[25]+=-c*b,h[26]+=-c,h[30]+=l*l,h[31]+=l*b,h[32]+=l,h[33]+=l*-d*l,h[34]+=l*-d*b,h[35]+=l*-d,h[40]+=b*b,h[41]+=b,h[42]+=b*-d*l,h[43]+=b*-d*b,h[44]+=b*-d,h[50]+=1,h[51]+=-d*l,h[52]+=-d*b,h[53]+=-d,h[60]+=-c*l*-c*l+-d*l*-d*l,h[61]+=-c*l*-c*b+-d*l*-d*b,h[62]+=-c*l*-c+-d*l*-d,h[70]+=-c*b*-c*b+-d*b*-d*b,h[71]+=-c*b*-c+-d*b*-d,h[80]+=-c*-c+-d*-d;for(i=0;i<9;++i)for(f=0;f<i;++f)h[9*i+f]=h[9*f+i];return p.eigenVV(this.mLtL,this.Evec),o[0]=u[72],o[1]=u[73],o[2]=u[74],o[3]=u[75],o[4]=u[76],o[5]=u[77],o[6]=u[78],o[7]=u[79],o[8]=u[80],y.multiply_3x3(r,this.T1,r),y.multiply_3x3(r,r,this.T0),c=1/o[8],o[0]*=c,o[1]*=c,o[2]*=c,o[3]*=c,o[4]*=c,o[5]*=c,o[6]*=c,o[7]*=c,o[8]=1,1}},{key:"error",value:function(t,e,r,a,i){for(var f,o,n=0,s=0,h=0,u=0,c=r.data;n<i;++n)f=t[n],o=e[n],s=1/(c[6]*f.x+c[7]*f.y+1),h=(c[0]*f.x+c[1]*f.y+c[2])*s-o.x,u=(c[3]*f.x+c[4]*f.y+c[5])*s-o.y,a[n]=h*h+u*u}},{key:"check_subset",value:function(t,e,r){var a=new v;if(4==r){var i=0,f=t[0],o=t[1],n=t[2],s=t[3],h=e[0],u=e[1],c=e[2],_=e[3],d=f.x,l=f.y,b=o.x,p=o.y,y=n.x,w=n.y,m=h.x,k=h.y,M=u.x,g=u.y,x=c.x,O=c.y,C=a.determinant_3x3(d,l,1,b,p,1,y,w,1),R=a.determinant_3x3(m,k,1,M,g,1,x,O,1);if(C*R<0&&i++,d=o.x,l=o.y,b=n.x,p=n.y,y=s.x,w=s.y,m=u.x,k=u.y,M=c.x,g=c.y,x=_.x,O=_.y,(C=a.determinant_3x3(d,l,1,b,p,1,y,w,1))*(R=a.determinant_3x3(m,k,1,M,g,1,x,O,1))<0&&i++,d=f.x,l=f.y,b=n.x,p=n.y,y=s.x,w=s.y,m=h.x,k=h.y,M=c.x,g=c.y,x=_.x,O=_.y,(C=a.determinant_3x3(d,l,1,b,p,1,y,w,1))*(R=a.determinant_3x3(m,k,1,M,g,1,x,O,1))<0&&i++,d=f.x,l=f.y,b=o.x,p=o.y,y=s.x,w=s.y,m=h.x,k=h.y,M=u.x,g=u.y,x=_.x,O=_.y,(C=a.determinant_3x3(d,l,1,b,p,1,y,w,1))*(R=a.determinant_3x3(m,k,1,M,g,1,x,O,1))<0&&i++,0!=i&&4!=i)return!1}return!0}}]),o}(function(){function t(){a(this,t),this.T0=new l(3,3,_.F32_t|_.C1_t),this.T1=new l(3,3,_.F32_t|_.C1_t),this.AtA=new l(6,6,_.F32_t|_.C1_t),this.AtB=new l(6,1,_.F32_t|_.C1_t)}return f(t,[{key:"sqr",value:function(t){return t*t}},{key:"iso_normalize_points",value:function(t,e,r,a,i){for(var f,o,n=0,s=0,h=0,u=0,c=0,_=0,d=0,l=0,b=0;n<i;++n)s+=t[n].x,h+=t[n].y,c+=e[n].x,_+=e[n].y;for(s/=i,h/=i,c/=i,_/=i,n=0;n<i;++n)l=t[n].x-s,b=t[n].y-h,u+=Math.sqrt(l*l+b*b),l=e[n].x-c,b=e[n].y-_,d+=Math.sqrt(l*l+b*b);u/=i,d/=i,f=Math.SQRT2/u,o=Math.SQRT2/d,r[0]=r[4]=f,r[2]=-s*f,r[5]=-h*f,r[1]=r[3]=r[6]=r[7]=0,r[8]=1,a[0]=a[4]=o,a[2]=-c*o,a[5]=-_*o,a[1]=a[3]=a[6]=a[7]=0,a[8]=1}},{key:"have_collinear_points",value:function(t,e){for(var r=0,a=0,i=e-1|0,f=0,o=0,n=0,s=0;r<i;++r)for(f=t[r].x-t[i].x,o=t[r].y-t[i].y,a=0;a<r;++a)if(n=t[a].x-t[i].x,s=t[a].y-t[i].y,Math.abs(n*o-s*f)<=_.EPSILON*(Math.abs(f)+Math.abs(o)+Math.abs(n)+Math.abs(s)))return!0;return!1}}]),t}()),I=function(){function t(e,r,i,f){a(this,t),void 0===e&&(e=0),void 0===r&&(r=.5),void 0===i&&(i=.5),void 0===f&&(f=.99),this.size=e,this.thresh=r,this.eps=i,this.prob=f}return f(t,[{key:"update_iters",value:function(t,e){var r=Math.log(1-this.prob),a=Math.log(1-Math.pow(1-t,this.size));return 0|(a>=0||-r>=e*-a?e:Math.round(r/a))}}]),t}(),F=function(){function t(){a(this,t);var e=new b;this.cache=new u,this.cache.allocate(30,2560),this.scharr_deriv=e.scharr_derivatives}return f(t,[{key:"track",value:function(t,e,r,a,i,f,o,n,s,h){void 0===o&&(o=30),void 0===n&&(n=new Uint8Array(i)),void 0===s&&(s=.01),void 0===h&&(h=1e-4);var u=.5*(f-1),c=f*f|0,d=c<<1,b=t.data,v=e.data,p=b[0].data,y=v[0].data,w=b[0].cols,m=b[0].rows,k=0,M=0,g=this.cache.get_buffer(c<<2),x=this.cache.get_buffer(d<<2),O=this.cache.get_buffer(m*(w<<1)<<2),C=new l(w,m,_.S32C2_t,O.data),R=g.i32,S=x.i32,A=O.i32,L=0,z=0,G=0,U=0,B=0,I=0,F=0,P=0,T=0,q=0,E=0,N=0,j=0,V=0,Y=0,D=0,J=0,X=0,H=0,Q=0,K=0,W=0,Z=0,$=0,tt=0,et=0,rt=0,at=0,it=0,ft=0,ot=0,nt=0,st=16384,ht=1/(1<<20),ut=0,ct=0,_t=0,dt=0,lt=0,bt=0,vt=0,pt=0,yt=0,wt=0,mt=0;for(s*=s;Q<i;++Q)n[Q]=1;var kt=t.levels-1|0;for($=kt;$>=0;--$)for(F=1/(1<<$),M=m>>$,L=(k=w>>$)<<1,p=b[$].data,y=v[$].data,rt=k-f|0,at=M-f|0,this.scharr_deriv(b[$],C),tt=0;tt<i;++tt)if(K=1+(Q=tt<<1),P=r[Q]*F,T=r[K]*F,$==kt?(q=P,E=T):(q=2*a[Q],E=2*a[K]),a[Q]=q,a[K]=E,0==(W=(D=0|(P-=u))<=0|D>=rt|(J=0|(T-=u))<=0|J>=at)){for(dt=st-(ut=(1-(it=P-D))*(1-(ft=T-J))*st+.5|0)-(ct=it*(1-ft)*st+.5|0)-(_t=(1-it)*ft*st+.5|0),pt=0,yt=0,wt=0,Z=0;Z<f;++Z)for(G=(z=(Z+J)*k+D|0)<<1,B=(U=Z*f|0)<<1,W=0;W<f;++W,++z,++U,G+=2)lt=256+(lt=p[z]*ut+p[z+1]*ct+p[z+k]*_t+p[z+k+1]*dt)>>9,bt=8192+(bt=A[G]*ut+A[G+2]*ct+A[G+L]*_t+A[G+L+2]*dt)>>14,vt=8192+(vt=A[G+1]*ut+A[G+3]*ct+A[G+L+1]*_t+A[G+L+3]*dt)>>14,R[U]=lt,S[B++]=bt,S[B++]=vt,pt+=bt*bt,yt+=bt*vt,wt+=vt*vt;if(mt=(pt*=ht)*(wt*=ht)-(yt*=ht)*yt,(wt+pt-Math.sqrt((pt-wt)*(pt-wt)+4*yt*yt))/d<h||mt<1.1920929e-7)0==$&&(n[tt]=0);else for(mt=1/mt,q-=u,E-=u,N=0,j=0,et=0;et<o;++et){if(0!=(W=(X=0|q)<=0|X>=rt|(H=0|E)<=0|H>=at)){0==$&&(n[tt]=0);break}for(dt=st-(ut=(1-(it=q-X))*(1-(ft=E-H))*st+.5|0)-(ct=it*(1-ft)*st+.5|0)-(_t=(1-it)*ft*st+.5|0),ot=0,nt=0,Z=0;Z<f;++Z)for(I=(Z+H)*k+X|0,B=(U=Z*f|0)<<1,W=0;W<f;++W,++I,++U)lt=256+(lt=y[I]*ut+y[I+1]*ct+y[I+k]*_t+y[I+k+1]*dt)>>9,ot+=(lt-=R[U])*S[B++],nt+=lt*S[B++];if(q+=V=(yt*(nt*=ht)-wt*(ot*=ht))*mt,E+=Y=(yt*ot-pt*nt)*mt,a[Q]=q+u,a[K]=E+u,V*V+Y*Y<=s)break;if(et>0&&Math.abs(V+N)<.01&&Math.abs(Y+j)<.01){a[Q]-=.5*V,a[K]-=.5*Y;break}N=V,j=Y}}else 0==$&&(n[tt]=0);this.cache.put_buffer(g),this.cache.put_buffer(x),this.cache.put_buffer(O)}}]),t}(),P=function(){function t(){a(this,t),this.dt=new n}return f(t,[{key:"get_data_type",value:function(t){return this.dt._get_data_type(t)}},{key:"get_channel",value:function(t){return this.dt._get_channel(t)}},{key:"get_data_type_size",value:function(t){return this.dt._get_data_type_size(t)}}]),t}();o(P,"VERSION","0.4.0"),o(P,"EPSILON",_.EPSILON),o(P,"FLT_MIN",_.FLT_MIN),o(P,"U8_t",_.U8_t),o(P,"S32_t",_.S32_t),o(P,"F32_t",_.F32_t),o(P,"S64_t",_.S64_t),o(P,"F64_t",_.F64_t),o(P,"F64_t",_.F64_t),o(P,"C1_t",_.C1_t),o(P,"C2_t",_.C2_t),o(P,"C3_t",_.C3_t),o(P,"C4_t",_.C4_t),o(P,"COLOR_RGBA2GRAY",_.COLOR_RGBA2GRAY),o(P,"COLOR_RGB2GRAY",_.COLOR_RGBA2GRAY),o(P,"COLOR_BGRA2GRAY",_.COLOR_RGBA2GRAY),o(P,"COLOR_BGR2GRAY",_.COLOR_RGBA2GRAY),o(P,"BOX_BLUR_NOSCALE",_.BOX_BLUR_NOSCALE),o(P,"SVD_U_T",_.SVD_U_T),o(P,"SVD_V_T",_.SVD_V_T),o(P,"U8C1_t",P.U8_t|P.C1_t),o(P,"U8C3_t",P.U8_t|P.C3_t),o(P,"U8C4_t",P.U8_t|P.C4_t),o(P,"F32C1_t",P.F32_t|P.C1_t),o(P,"F32C2_t",P.F32_t|P.C2_t),o(P,"S32C1_t",P.S32_t|P.C1_t),o(P,"S32C2_t",P.S32_t|P.C2_t),P.data_t=s,P.matrix_t=l,P.pyramid_t=p,P.keypoint_t=c,P.cache=u,P.imgproc=b,P.math=d,P.matmath=v,P.linalg=m,P.orb=M,P.yape=C,P.yape06=S,P.motion_estimator=A,P.ransac_params_t=I,P.homography2d=B,P.optical_flow_lk=F;const T={jsfeatNext:P};return e.default})()));