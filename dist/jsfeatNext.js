!function(t,e){"object"==typeof exports&&"object"==typeof module?module.exports=e():"function"==typeof define&&define.amd?define([],e):"object"==typeof exports?exports.jsfeatNext=e():t.jsfeatNext=e()}(this,(()=>(()=>{"use strict";var t={d:(e,r)=>{for(var a in r)t.o(r,a)&&!t.o(e,a)&&Object.defineProperty(e,a,{enumerable:!0,get:r[a]})},o:(t,e)=>Object.prototype.hasOwnProperty.call(t,e)},e={};function r(t,e){return r=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(t,e){return t.__proto__=e,t},r(t,e)}function a(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),Object.defineProperty(t,"prototype",{writable:!1}),e&&r(t,e)}function i(t){return i="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},i(t)}function f(t,e){if(e&&("object"===i(e)||"function"==typeof e))return e;if(void 0!==e)throw new TypeError("Derived constructors may only return object or undefined");return function(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}(t)}function o(t){return o=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(t){return t.__proto__||Object.getPrototypeOf(t)},o(t)}function n(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function s(t,e){for(var r=0;r<e.length;r++){var a=e[r];a.enumerable=a.enumerable||!1,a.configurable=!0,"value"in a&&(a.writable=!0),Object.defineProperty(t,a.key,a)}}function u(t,e,r){return e&&s(t.prototype,e),r&&s(t,r),Object.defineProperty(t,"prototype",{writable:!1}),t}function h(t,e,r){return e in t?Object.defineProperty(t,e,{value:r,enumerable:!0,configurable:!0,writable:!0}):t[e]=r,t}t.d(e,{default:()=>P});var c=function(){function t(){n(this,t),this._data_type_size=new Int32Array([-1,1,4,-1,4,-1,-1,-1,8,-1,-1,-1,-1,-1,-1,-1,8])}return u(t,[{key:"_get_data_type",value:function(t){return 65280&t}},{key:"_get_channel",value:function(t){return 255&t}},{key:"_get_data_type_size",value:function(t){return this._data_type_size[(65280&t)>>8]}}]),t}(),_=u((function t(e,r){n(this,t),this.size=-8&(e+7|0),void 0===r?this.buffer=new ArrayBuffer(this.size):(this.buffer=r,this.size=r.length),this.u8=new Uint8Array(this.buffer),this.i32=new Int32Array(this.buffer),this.f32=new Float32Array(this.buffer),this.f64=new Float64Array(this.buffer)})),l=function(){function t(e){n(this,t),this.next=null,this.data=new _(e),this.size=this.data.size,this.buffer=this.data.buffer,this.u8=this.data.u8,this.i32=this.data.i32,this.f32=this.data.f32,this.f64=this.data.f64}return u(t,[{key:"resize",value:function(t){delete this.data,this.data=new _(t),this.size=this.data.size,this.buffer=this.data.buffer,this.u8=this.data.u8,this.i32=this.data.i32,this.f32=this.data.f32,this.f64=this.data.f64}}]),t}(),d=function(){function t(){n(this,t),this._pool_head,this._pool_tail,this._pool_size=0}return u(t,[{key:"allocate",value:function(t,e){this._pool_head=this._pool_tail=new l(e);for(var r=0;r<t;++r){var a=new l(e);this._pool_tail=this._pool_tail.next=a,this._pool_size++}}},{key:"get_buffer",value:function(t){var e=this._pool_head;return this._pool_head=this._pool_head.next,this._pool_size--,t>e.size&&e.resize(t),e}},{key:"put_buffer",value:function(t){this._pool_tail=this._pool_tail.next=t,this._pool_size++}}]),t}(),v=u((function t(e,r,a,i,f){n(this,t),void 0===e&&(e=0),void 0===r&&(r=0),void 0===a&&(a=0),void 0===i&&(i=0),void 0===f&&(f=-1),this.x=e,this.y=r,this.score=a,this.level=i,this.angle=f})),b=function(){function t(){n(this,t)}return u(t,[{key:"identity",value:function(t,e){void 0===e&&(e=1);for(var r=t.data,a=t.rows,i=t.cols,f=i+1|0,o=a*i,n=o;--o>=0;)r[o]=0;for(o=n,n=0;n<o;)r[n]=e,n+=f}},{key:"transpose",value:function(t,e){for(var r=0,a=0,i=e.rows,f=e.cols,o=0,n=0,s=0,u=e.data,h=t.data;r<i;n+=1,o+=f,r++)for(s=n,a=0;a<f;s+=i,a++)h[s]=u[o+a]}},{key:"multiply",value:function(t,e,r){for(var a=0,i=0,f=0,o=0,n=0,s=0,u=0,h=0,c=e.cols,_=e.rows,l=r.cols,d=e.data,v=r.data,b=t.data,p=0;a<_;o+=c,a++)for(u=0,i=0;i<l;h++,u++,i++){for(s=u,n=o,p=0,f=0;f<c;n++,s+=l,f++)p+=d[n]*v[s];b[h]=p}}},{key:"multiply_ABt",value:function(t,e,r){for(var a=0,i=0,f=0,o=0,n=0,s=0,u=0,h=e.cols,c=e.rows,_=r.rows,l=e.data,d=r.data,v=t.data,b=0;a<c;o+=h,a++)for(s=0,i=0;i<_;u++,i++){for(n=o,b=0,f=0;f<h;n++,s++,f++)b+=l[n]*d[s];v[u]=b}}},{key:"multiply_AtB",value:function(t,e,r){for(var a=0,i=0,f=0,o=0,n=0,s=0,u=0,h=0,c=e.cols,_=e.rows,l=r.cols,d=e.data,v=r.data,b=t.data,p=0;a<c;o++,a++)for(u=0,i=0;i<l;h++,u++,i++){for(s=u,n=o,p=0,f=0;f<_;n+=c,s+=l,f++)p+=d[n]*v[s];b[h]=p}}},{key:"multiply_AAt",value:function(t,e){for(var r=0,a=0,i=0,f=0,o=0,n=0,s=0,u=0,h=0,c=e.cols,_=e.rows,l=e.data,d=t.data,v=0;r<_;f+=_+1,o=n,r++)for(u=f,h=f,s=o,a=r;a<_;u++,h+=_,a++){for(n=o,v=0,i=0;i<c;i++)v+=l[n++]*l[s++];d[u]=v,d[h]=v}}},{key:"multiply_AtA",value:function(t,e){for(var r=0,a=0,i=0,f=0,o=0,n=0,s=0,u=0,h=0,c=e.cols,_=e.rows,l=e.data,d=t.data,v=0;r<c;s+=c,r++)for(f=r,u=h=s+r,a=r;a<c;u++,h+=c,a++){for(o=f,n=a,v=0,i=0;i<_;o+=c,n+=c,i++)v+=l[o]*l[n];d[u]=v,d[h]=v}}},{key:"identity_3x3",value:function(t,e){void 0===e&&(e=1);var r=t.data;r[0]=r[4]=r[8]=e,r[1]=r[2]=r[3]=0,r[5]=r[6]=r[7]=0}},{key:"invert_3x3",value:function(t,e){var r=t.data,a=e.data,i=r[4],f=r[8],o=r[5],n=r[7],s=r[0],u=s*i,h=s*o,c=r[3],_=r[1],l=c*_,d=r[2],v=c*d,b=r[6],p=b*_,y=b*d,m=1/(u*f-h*n-l*f+v*n+p*o-y*i);a[0]=(i*f-o*n)*m,a[1]=-(_*f-d*n)*m,a[2]=-(-_*o+d*i)*m,a[3]=-(c*f-o*b)*m,a[4]=(s*f-y)*m,a[5]=-(h-v)*m,a[6]=-(-c*n+i*b)*m,a[7]=-(s*n-p)*m,a[8]=(u-l)*m}},{key:"multiply_3x3",value:function(t,e,r){var a=t.data,i=e.data,f=r.data,o=i[0],n=i[1],s=i[2],u=i[3],h=i[4],c=i[5],_=i[6],l=i[7],d=i[8],v=f[0],b=f[1],p=f[2],y=f[3],m=f[4],w=f[5],k=f[6],M=f[7],g=f[8];a[0]=o*v+n*y+s*k,a[1]=o*b+n*m+s*M,a[2]=o*p+n*w+s*g,a[3]=u*v+h*y+c*k,a[4]=u*b+h*m+c*M,a[5]=u*p+h*w+c*g,a[6]=_*v+l*y+d*k,a[7]=_*b+l*m+d*M,a[8]=_*p+l*w+d*g}},{key:"mat3x3_determinant",value:function(t){var e=t.data;return e[0]*e[4]*e[8]-e[0]*e[5]*e[7]-e[3]*e[1]*e[8]+e[3]*e[2]*e[7]+e[6]*e[1]*e[5]-e[6]*e[2]*e[4]}},{key:"determinant_3x3",value:function(t,e,r,a,i,f,o,n,s){return t*i*s-t*f*n-a*e*s+a*r*n+o*e*f-o*r*i}}]),t}(),p=1.192092896e-7,y=256,m=512,w=1024,k=function(){function t(e,r,a,i){n(this,t),this.dt=new c,this.type=0|this.dt._get_data_type(a),this.channel=0|this.dt._get_channel(a),this.cols=0|e,this.rows=0|r,void 0===i?this.allocate():(this.buffer=i,this.data=this.type&y?this.buffer.u8:this.type&m?this.buffer.i32:this.type&w?this.buffer.f32:this.buffer.f64)}return u(t,[{key:"allocate",value:function(){delete this.data,delete this.buffer,this.buffer=new _(this.cols*this.dt._get_data_type_size(this.type)*this.channel*this.rows),this.data=this.type&y?this.buffer.u8:this.type&m?this.buffer.i32:this.type&w?this.buffer.f32:this.buffer.f64}},{key:"copy_to",value:function(t){for(var e=t.data,r=this.data,a=0,i=this.cols*this.rows*this.channel|0;a<i-4;a+=4)e[a]=r[a],e[a+1]=r[a+1],e[a+2]=r[a+2],e[a+3]=r[a+3];for(;a<i;++a)e[a]=r[a]}},{key:"resize",value:function(t,e,r){void 0===r&&(r=this.channel),t*this.dt._get_data_type_size(this.type)*r*e>this.buffer.size?(this.cols=t,this.rows=e,this.channel=r,this.allocate()):(this.cols=t,this.rows=e,this.channel=r)}}]),t}();function M(t,e,r,a){a=t[e],t[e]=t[r],t[r]=a}function g(t,e){return(t=Math.abs(t))>(e=Math.abs(e))?(e/=t,t*Math.sqrt(1+e*e)):e>0?(t/=e,e*Math.sqrt(1+t*t)):0}var x=[8,-3,9,5,4,2,7,-12,-11,9,-8,2,7,-12,12,-13,2,-13,2,12,1,-7,1,6,-2,-10,-2,-4,-13,-13,-11,-8,-13,-3,-12,-9,10,4,11,9,-13,-8,-8,-9,-11,7,-9,12,7,7,12,6,-4,-5,-3,0,-13,2,-12,-3,-9,0,-7,5,12,-6,12,-1,-3,6,-2,12,-6,-13,-4,-8,11,-13,12,-8,4,7,5,1,5,-3,10,-3,3,-7,6,12,-8,-7,-6,-2,-2,11,-1,-10,-13,12,-8,10,-7,3,-5,-3,-4,2,-3,7,-10,-12,-6,11,5,-12,6,-7,5,-6,7,-1,1,0,4,-5,9,11,11,-13,4,7,4,12,2,-1,4,4,-4,-12,-2,7,-8,-5,-7,-10,4,11,9,12,0,-8,1,-13,-13,-2,-8,2,-3,-2,-2,3,-6,9,-4,-9,8,12,10,7,0,9,1,3,7,-5,11,-10,-13,-6,-11,0,10,7,12,1,-6,-3,-6,12,10,-9,12,-4,-13,8,-8,-12,-13,0,-8,-4,3,3,7,8,5,7,10,-7,-1,7,1,-12,3,-10,5,6,2,-4,3,-10,-13,0,-13,5,-13,-7,-12,12,-13,3,-11,8,-7,12,-4,7,6,-10,12,8,-9,-1,-7,-6,-2,-5,0,12,-12,5,-7,5,3,-10,8,-13,-7,-7,-4,5,-3,-2,-1,-7,2,9,5,-11,-11,-13,-5,-13,-1,6,0,-1,5,-3,5,2,-4,-13,-4,12,-9,-6,-9,6,-12,-10,-8,-4,10,2,12,-3,7,12,12,12,-7,-13,-6,5,-4,9,-3,4,7,-1,12,2,-7,6,-5,1,-13,11,-12,5,-3,7,-2,-6,7,-8,12,-7,-13,-7,-11,-12,1,-3,12,12,2,-6,3,0,-4,3,-2,-13,-1,-13,1,9,7,1,8,-6,1,-1,3,12,9,1,12,6,-1,-9,-1,3,-13,-13,-10,5,7,7,10,12,12,-5,12,9,6,3,7,11,5,-13,6,10,2,-12,2,3,3,8,4,-6,2,6,12,-13,9,-12,10,3,-8,4,-7,9,-11,12,-4,-6,1,12,2,-8,6,-9,7,-4,2,3,3,-2,6,3,11,0,3,-3,8,-8,7,8,9,3,-11,-5,-6,-4,-10,11,-5,10,-5,-8,-3,12,-10,5,-9,0,8,-1,12,-6,4,-6,6,-11,-10,12,-8,7,4,-2,6,7,-2,0,-2,12,-5,-8,-5,2,7,-6,10,12,-9,-13,-8,-8,-5,-13,-5,-2,8,-8,9,-13,-9,-11,-9,0,1,-8,1,-2,7,-4,9,1,-2,1,-1,-4,11,-6,12,-11,-12,-9,-6,4,3,7,7,12,5,5,10,8,0,-4,2,8,-9,12,-5,-13,0,7,2,12,-1,2,1,7,5,11,7,-9,3,5,6,-8,-13,-4,-8,9,-5,9,-3,-3,-4,-7,-3,-12,6,5,8,0,-7,6,-6,12,-13,6,-5,-2,1,-10,3,10,4,1,8,-4,-2,-2,2,-13,2,-12,12,12,-2,-13,0,-6,4,1,9,3,-6,-10,-3,-5,-3,-13,-1,1,7,5,12,-11,4,-2,5,-7,-13,9,-9,-5,7,1,8,6,7,-8,7,6,-7,-4,-7,1,-8,11,-7,-8,-13,6,-12,-8,2,4,3,9,10,-5,12,3,-6,-5,-6,7,8,-3,9,-8,2,-12,2,8,-11,-2,-10,3,-12,-13,-7,-9,-11,0,-10,-5,5,-3,11,8,-2,-13,-1,12,-1,-8,0,9,-13,-11,-12,-5,-10,-2,-10,11,-3,9,-2,-13,2,-3,3,2,-9,-13,-4,0,-4,6,-3,-10,-4,12,-2,-7,-6,-11,-4,9,6,-3,6,11,-13,11,-5,5,11,11,12,6,7,-5,12,-2,-1,12,0,7,-4,-8,-3,-2,-7,1,-6,7,-13,-12,-8,-13,-7,-2,-6,-8,-8,5,-6,-9,-5,-1,-4,5,-13,7,-8,10,1,5,5,-13,1,0,10,-13,9,12,10,-1,5,-8,10,-9,-1,11,1,-13,-9,-3,-6,2,-1,-10,1,12,-13,1,-8,-10,8,-11,10,-6,2,-13,3,-6,7,-13,12,-9,-10,-10,-5,-7,-10,-8,-8,-13,4,-6,8,5,3,12,8,-13,-4,2,-3,-3,5,-13,10,-12,4,-13,5,-1,-9,9,-4,3,0,3,3,-9,-12,1,-6,1,3,2,4,-8,-10,-10,-10,9,8,-13,12,12,-8,-12,-6,-5,2,2,3,7,10,6,11,-8,6,8,8,-12,-7,10,-6,5,-3,-9,-3,9,-1,-13,-1,5,-3,-7,-3,4,-8,-2,-8,3,4,2,12,12,2,-5,3,11,6,-9,11,-13,3,-1,7,12,11,-1,12,4,-3,0,-3,6,4,-11,4,12,2,-4,2,1,-10,-6,-8,1,-13,7,-11,1,-13,12,-11,-13,6,0,11,-13,0,-1,1,4,-13,3,-9,-2,-9,8,-6,-3,-13,-6,-8,-2,5,-9,8,10,2,7,3,-9,-1,-6,-1,-1,9,5,11,-2,11,-3,12,-8,3,0,3,5,-1,4,0,10,3,-6,4,5,-13,0,-10,5,5,8,12,11,8,9,9,-6,7,-4,8,-12,-10,4,-10,9,7,3,12,4,9,-7,10,-2,7,0,12,-2,-1,-6,0,-11];function A(t,e,r,a,i,f,o,n){var s=Math.cos(r),u=Math.sin(r);o.data[0]=s,o.data[1]=-u,o.data[2]=(-s+u)*f*.5+a,o.data[3]=u,o.data[4]=s,o.data[5]=(-u-s)*f*.5+i,n.warp_affine(t,e,o,128)}function z(t,e,r,a,i){var f,o;if(r>0)for(e-=a*i,o=-i;o<=i;++o){for(f=-i;f<=i;++f)if(t[e+f]>r)return!1;e+=a}else for(e-=a*i,o=-i;o<=i;++o){for(f=-i;f<=i;++f)if(t[e+f]<r)return!1;e+=a}return!0}function O(t,e,r,a,i,f,o,n){var s=0,u=0,h=o-1|0,c=0,_=0,l=0,d=0,v=0;if((c=t[e+f[u]])<=i)if(c>=a)if((_=t[e+f[h]])<=i){if(_>=a)return void(r[e]=0);if((l=t[e+f[++h]])>i)if((d=t[e+f[++h]])>i)v=3;else{if(!(d<a))return void(r[e]=0);v=6}else if((d=t[e+f[++h]])>i)v=7;else{if(!(d<a))return void(r[e]=0);v=2}}else if((l=t[e+f[++h]])>i)if((d=t[e+f[++h]])>i)v=3;else{if(!(d<a))return void(r[e]=0);v=6}else{if(!(l<a))return void(r[e]=0);if((d=t[e+f[++h]])>i)v=7;else{if(!(d<a))return void(r[e]=0);v=2}}else{if((_=t[e+f[h]])>i)return void(r[e]=0);if((l=t[e+f[++h]])>i)return void(r[e]=0);if((d=t[e+f[++h]])>i)return void(r[e]=0);v=1}else{if((_=t[e+f[h]])<a)return void(r[e]=0);if((l=t[e+f[++h]])<a)return void(r[e]=0);if((d=t[e+f[++h]])<a)return void(r[e]=0);v=0}for(u=1;u<=o;u++)switch(c=t[e+f[u]],v){case 0:if(c>i){if(l=d,(d=t[e+f[++h]])<a)return void(r[e]=0);s-=c+l,v=0;break}if(c<a){if(l>i)return void(r[e]=0);if(d>i)return void(r[e]=0);if(l=d,(d=t[e+f[++h]])>i)return void(r[e]=0);s-=c+l,v=8;break}if(l<=i)return void(r[e]=0);if(d<=i)return void(r[e]=0);if(l=d,(d=t[e+f[++h]])>i){s-=c+l,v=3;break}if(d<a){s-=c+l,v=6;break}return void(r[e]=0);case 1:if(c<a){if(l=d,(d=t[e+f[++h]])>i)return void(r[e]=0);s-=c+l,v=1;break}if(c>i){if(l<a)return void(r[e]=0);if(d<a)return void(r[e]=0);if(l=d,(d=t[e+f[++h]])<a)return void(r[e]=0);s-=c+l,v=9;break}if(l>=a)return void(r[e]=0);if(d>=a)return void(r[e]=0);if(l=d,(d=t[e+f[++h]])<a){s-=c+l,v=2;break}if(d>i){s-=c+l,v=7;break}return void(r[e]=0);case 2:if(c>i)return void(r[e]=0);if(l=d,d=t[e+f[++h]],c<a){if(d>i)return void(r[e]=0);s-=c+l,v=4;break}if(d>i){s-=c+l,v=7;break}if(d<a){s-=c+l,v=2;break}return void(r[e]=0);case 3:if(c<a)return void(r[e]=0);if(l=d,d=t[e+f[++h]],c>i){if(d<a)return void(r[e]=0);s-=c+l,v=5;break}if(d>i){s-=c+l,v=3;break}if(d<a){s-=c+l,v=6;break}return void(r[e]=0);case 4:if(c>i)return void(r[e]=0);if(c<a){if(l=d,(d=t[e+f[++h]])>i)return void(r[e]=0);s-=c+l,v=1;break}if(d>=a)return void(r[e]=0);if(l=d,(d=t[e+f[++h]])<a){s-=c+l,v=2;break}if(d>i){s-=c+l,v=7;break}return void(r[e]=0);case 5:if(c<a)return void(r[e]=0);if(c>i){if(l=d,(d=t[e+f[++h]])<a)return void(r[e]=0);s-=c+l,v=0;break}if(d<=i)return void(r[e]=0);if(l=d,(d=t[e+f[++h]])>i){s-=c+l,v=3;break}if(d<a){s-=c+l,v=6;break}return void(r[e]=0);case 7:if(c>i)return void(r[e]=0);if(c<a)return void(r[e]=0);if(l=d,(d=t[e+f[++h]])>i){s-=c+l,v=3;break}if(d<a){s-=c+l,v=6;break}return void(r[e]=0);case 6:if(c>i)return void(r[e]=0);if(c<a)return void(r[e]=0);if(l=d,(d=t[e+f[++h]])<a){s-=c+l,v=2;break}if(d>i){s-=c+l,v=7;break}return void(r[e]=0);case 8:if(c>i){if(d<a)return void(r[e]=0);if(l=d,(d=t[e+f[++h]])<a)return void(r[e]=0);s-=c+l,v=9;break}if(c<a){if(l=d,(d=t[e+f[++h]])>i)return void(r[e]=0);s-=c+l,v=1;break}return void(r[e]=0);case 9:if(c<a){if(d>i)return void(r[e]=0);if(l=d,(d=t[e+f[++h]])>i)return void(r[e]=0);s-=c+l,v=8;break}if(c>i){if(l=d,(d=t[e+f[++h]])<a)return void(r[e]=0);s-=c+l,v=0;break}return void(r[e]=0)}r[e]=s+n*t[e]}var q=u((function t(e,r,a){n(this,t),this.dirs=new Int32Array(1024),this.dirs_count=0|function(t,e,r){var a,i,f=0;for(a=r,i=0;i<a;i++,f++)a=Math.sqrt(r*r-i*i)+.5|0,e[f]=a+t*i;for(a--;a<i&&a>=0;a--,f++)i=Math.sqrt(r*r-a*a)+.5|0,e[f]=a+t*i;for(;-a<i;a--,f++)i=Math.sqrt(r*r-a*a)+.5|0,e[f]=a+t*i;for(i--;i>=0;i--,f++)a=-Math.sqrt(r*r-i*i)-.5|0,e[f]=a+t*i;for(;i>a;i--,f++)a=-Math.sqrt(r*r-i*i)-.5|0,e[f]=a+t*i;for(a++;a<=0;a++,f++)i=-Math.sqrt(r*r-a*a)-.5|0,e[f]=a+t*i;for(;a<-i;a++,f++)i=-Math.sqrt(r*r-a*a)-.5|0,e[f]=a+t*i;for(i++;i<0;i++,f++)a=Math.sqrt(r*r-i*i)+.5|0,e[f]=a+t*i;return e[f]=e[0],e[f+1]=e[1],f}(e,this.dirs,a),this.scores=new Int32Array(e*r),this.radius=0|a})),C=function(){function t(){n(this,t),this.level_tables=[],this.tau=7}return u(t,[{key:"init",value:function(t,e,r,a){var i;for(void 0===a&&(a=1),r=Math.min(r,7),r=Math.max(r,3),i=0;i<a;++i)this.level_tables[i]=new q(t>>i,e>>i,r)}},{key:"detect",value:function(t,e,r){void 0===r&&(r=4);var a,i,f,o,n,s=this.level_tables[0],u=0|s.radius,h=u-1|0,c=s.dirs,_=0|s.dirs_count,l=_>>1,d=t.data,v=0|t.cols,b=0|t.rows,p=v>>1,y=s.scores,m=0,w=0,k=0,M=0,g=0,x=0,A=0,q=0,C=0|this.tau,R=0,B=0|Math.max(u+1,r),S=0|Math.max(u+1,r),j=0|Math.min(v-u-2,v-r),T=0|Math.min(b-u-2,b-r);for(k=S*v+B|0,w=S;w<T;++w,k+=v)for(m=B,M=k;m<j;++m,++M)g=d[M]+C,(x=d[M]-C)<d[M+u]&&d[M+u]<g&&x<d[M-u]&&d[M-u]<g?y[M]=0:O(d,M,y,x,g,c,l,_);for(k=S*v+B|0,w=S;w<T;++w,k+=v)for(m=B,M=k;m<j;++m,++M)q=y[M],(A=Math.abs(q))<5?(++m,++M):(o=v,n=void 0,n=0,0!=(i=y)[(f=M)+1]&&n++,0!=i[f-1]&&n++,0!=i[f+o]&&n++,0!=i[f+o+1]&&n++,0!=i[f+o-1]&&n++,0!=i[f-o]&&n++,0!=i[f-o+1]&&n++,0!=i[f-o-1]&&n++,n>=3&&z(y,M,q,p,u)&&((a=e[R]).x=m,a.y=w,a.score=A,++R,m+=h,M+=h));return R}}]),t}();function R(t,e,r,a,i,f,o){var n=-2*t[e]+t[e+a]+t[e-a],s=-2*t[e]+t[e+i]+t[e-i],u=t[e+f]+t[e-f]-t[e+o]-t[e-o],h=0|Math.sqrt((n-s)*(n-s)+4*u*u);return Math.min(Math.abs(r-h),Math.abs(-(r+h)))}var B=function(){function t(e,r,a,i){n(this,t),void 0===e&&(e=0),void 0===r&&(r=.5),void 0===a&&(a=.5),void 0===i&&(i=.99),this.size=e,this.thresh=r,this.eps=a,this.prob=i}return u(t,[{key:"update_iters",value:function(t,e){var r=Math.log(1-this.prob),a=Math.log(1-Math.pow(1-t,this.size));return 0|(a>=0||-r>=e*-a?e:Math.round(r/a))}}]),t}();function S(t){var e=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(t){return!1}}();return function(){var r,a=o(t);if(e){var i=o(this).constructor;r=Reflect.construct(a,arguments,i)}else r=a.apply(this,arguments);return f(this,r)}}var j=function(){function t(){n(this,t),this.dt=new c,this.cache=new d,this.cache.allocate(30,2560)}return u(t,[{key:"get_data_type",value:function(t){return this.dt._get_data_type(t)}},{key:"get_channel",value:function(t){return this.dt._get_channel(t)}},{key:"get_data_type_size",value:function(t){return this.dt._get_data_type_size(t)}}]),t}();h(j,"VERSION","0.5.0"),h(j,"EPSILON",p),h(j,"FLT_MIN",1e-37),h(j,"U8_t",y),h(j,"S32_t",m),h(j,"F32_t",w),h(j,"S64_t",2048),h(j,"F64_t",4096),h(j,"F64_t",4096),h(j,"C1_t",1),h(j,"C2_t",2),h(j,"C3_t",3),h(j,"C4_t",4),h(j,"COLOR_RGBA2GRAY",0),h(j,"COLOR_RGB2GRAY",0),h(j,"COLOR_BGRA2GRAY",0),h(j,"COLOR_BGR2GRAY",0),h(j,"BOX_BLUR_NOSCALE",1),h(j,"SVD_U_T",1),h(j,"SVD_V_T",2),h(j,"U8C1_t",j.U8_t|j.C1_t),h(j,"U8C3_t",j.U8_t|j.C3_t),h(j,"U8C4_t",j.U8_t|j.C4_t),h(j,"F32C1_t",j.F32_t|j.C1_t),h(j,"F32C2_t",j.F32_t|j.C2_t),h(j,"S32C1_t",j.S32_t|j.C1_t),h(j,"S32C2_t",j.S32_t|j.C2_t);var T=function(t){a(r,t);var e=S(r);function r(){var t;return n(this,r),(t=e.call(this)).T0=new k(3,3,1025),t.T1=new k(3,3,1025),t.AtA=new k(6,6,1025),t.AtB=new k(6,1,1025),t}return u(r,[{key:"sqr",value:function(t){return t*t}},{key:"iso_normalize_points",value:function(t,e,r,a,i){for(var f,o,n=0,s=0,u=0,h=0,c=0,_=0,l=0,d=0,v=0;n<i;++n)s+=t[n].x,u+=t[n].y,c+=e[n].x,_+=e[n].y;for(s/=i,u/=i,c/=i,_/=i,n=0;n<i;++n)d=t[n].x-s,v=t[n].y-u,h+=Math.sqrt(d*d+v*v),d=e[n].x-c,v=e[n].y-_,l+=Math.sqrt(d*d+v*v);h/=i,l/=i,f=Math.SQRT2/h,o=Math.SQRT2/l,r[0]=r[4]=f,r[2]=-s*f,r[5]=-u*f,r[1]=r[3]=r[6]=r[7]=0,r[8]=1,a[0]=a[4]=o,a[2]=-c*o,a[5]=-_*o,a[1]=a[3]=a[6]=a[7]=0,a[8]=1}},{key:"have_collinear_points",value:function(t,e){for(var r=0,a=0,i=e-1|0,f=0,o=0,n=0,s=0;r<i;++r)for(f=t[r].x-t[i].x,o=t[r].y-t[i].y,a=0;a<r;++a)if(n=t[a].x-t[i].x,s=t[a].y-t[i].y,Math.abs(n*o-s*f)<=p*(Math.abs(f)+Math.abs(o)+Math.abs(n)+Math.abs(s)))return!0;return!1}}]),r}(j),I=function(t){a(r,t);var e=S(r);function r(){return n(this,r),e.call(this)}return u(r,[{key:"run",value:function(t,e,r,a){var i,f,o=0,n=0,s=1|r.type,u=r.data,h=this.T0.data,c=this.T1.data,_=0,l=0,d=new b,v=new j.linalg;this.iso_normalize_points(t,e,h,c,a);for(var p=this.cache.get_buffer(2*a*6<<3),y=this.cache.get_buffer(2*a<<3),m=new k(6,2*a,s,p.data),w=new k(1,2*a,s,y.data),M=m.data,g=w.data;o<a;++o)i=t[o],f=e[o],_=h[0]*i.x+h[1]*i.y+h[2],l=h[3]*i.x+h[4]*i.y+h[5],M[n=2*o*6]=_,M[n+1]=l,M[n+2]=1,M[n+3]=0,M[n+4]=0,M[n+5]=0,M[n+=6]=0,M[n+1]=0,M[n+2]=0,M[n+3]=_,M[n+4]=l,M[n+5]=1,g[o<<1]=c[0]*f.x+c[1]*f.y+c[2],g[1+(o<<1)]=c[3]*f.x+c[4]*f.y+c[5];return d.multiply_AtA(this.AtA,m),d.multiply_AtB(this.AtB,m,w),v.lu_solve(this.AtA,this.AtB),u[0]=this.AtB.data[0],u[1]=this.AtB.data[1],u[2]=this.AtB.data[2],u[3]=this.AtB.data[3],u[4]=this.AtB.data[4],u[5]=this.AtB.data[5],u[6]=0,u[7]=0,u[8]=1,d.invert_3x3(this.T1,this.T1),d.multiply_3x3(r,this.T1,r),d.multiply_3x3(r,r,this.T0),this.cache.put_buffer(p),this.cache.put_buffer(y),1}}]),r}(T),L=function(t){a(r,t);var e=S(r);function r(){var t;return n(this,r),(t=e.call(this)).mLtL=new k(9,9,1025),t.Evec=new k(9,9,1025),t}return u(r,[{key:"run",value:function(t,e,r,a){for(var i=0,f=0,o=r.data,n=this.T0.data,s=this.T1.data,u=this.mLtL.data,h=this.Evec.data,c=0,_=0,l=0,d=0,v=new j.linalg,y=new b,m=0,w=0,k=0,M=0,g=0,x=0,A=0,z=0;i<a;++i)k+=e[i].x,M+=e[i].y,A+=t[i].x,z+=t[i].y;for(k/=a,M/=a,A/=a,z/=a,i=0;i<a;++i)m+=Math.abs(e[i].x-k),w+=Math.abs(e[i].y-M),g+=Math.abs(t[i].x-A),x+=Math.abs(t[i].y-z);if(Math.abs(m)<p||Math.abs(w)<p||Math.abs(g)<p||Math.abs(x)<p)return 0;for(m=a/m,w=a/w,g=a/g,x=a/x,n[0]=g,n[1]=0,n[2]=-A*g,n[3]=0,n[4]=x,n[5]=-z*x,n[6]=0,n[7]=0,n[8]=1,s[0]=1/m,s[1]=0,s[2]=k,s[3]=0,s[4]=1/w,s[5]=M,s[6]=0,s[7]=0,s[8]=1,i=81;--i>=0;)u[i]=0;for(i=0;i<a;++i)c=(e[i].x-k)*m,_=(e[i].y-M)*w,l=(t[i].x-A)*g,d=(t[i].y-z)*x,u[0]+=l*l,u[1]+=l*d,u[2]+=l,u[6]+=l*-c*l,u[7]+=l*-c*d,u[8]+=l*-c,u[10]+=d*d,u[11]+=d,u[15]+=d*-c*l,u[16]+=d*-c*d,u[17]+=d*-c,u[20]+=1,u[24]+=-c*l,u[25]+=-c*d,u[26]+=-c,u[30]+=l*l,u[31]+=l*d,u[32]+=l,u[33]+=l*-_*l,u[34]+=l*-_*d,u[35]+=l*-_,u[40]+=d*d,u[41]+=d,u[42]+=d*-_*l,u[43]+=d*-_*d,u[44]+=d*-_,u[50]+=1,u[51]+=-_*l,u[52]+=-_*d,u[53]+=-_,u[60]+=-c*l*-c*l+-_*l*-_*l,u[61]+=-c*l*-c*d+-_*l*-_*d,u[62]+=-c*l*-c+-_*l*-_,u[70]+=-c*d*-c*d+-_*d*-_*d,u[71]+=-c*d*-c+-_*d*-_,u[80]+=-c*-c+-_*-_;for(i=0;i<9;++i)for(f=0;f<i;++f)u[9*i+f]=u[9*f+i];return v.eigenVV(this.mLtL,this.Evec),o[0]=h[72],o[1]=h[73],o[2]=h[74],o[3]=h[75],o[4]=h[76],o[5]=h[77],o[6]=h[78],o[7]=h[79],o[8]=h[80],y.multiply_3x3(r,this.T1,r),y.multiply_3x3(r,r,this.T0),c=1/o[8],o[0]*=c,o[1]*=c,o[2]*=c,o[3]*=c,o[4]*=c,o[5]*=c,o[6]*=c,o[7]*=c,o[8]=1,1}},{key:"error",value:function(t,e,r,a,i){for(var f,o,n=0,s=0,u=0,h=0,c=r.data;n<i;++n)f=t[n],o=e[n],s=1/(c[6]*f.x+c[7]*f.y+1),u=(c[0]*f.x+c[1]*f.y+c[2])*s-o.x,h=(c[3]*f.x+c[4]*f.y+c[5])*s-o.y,a[n]=u*u+h*h}},{key:"check_subset",value:function(t,e,r){var a=new b;if(4==r){var i=0,f=t[0],o=t[1],n=t[2],s=t[3],u=e[0],h=e[1],c=e[2],_=e[3],l=f.x,d=f.y,v=o.x,p=o.y,y=n.x,m=n.y,w=u.x,k=u.y,M=h.x,g=h.y,x=c.x,A=c.y,z=a.determinant_3x3(l,d,1,v,p,1,y,m,1),O=a.determinant_3x3(w,k,1,M,g,1,x,A,1);if(z*O<0&&i++,l=o.x,d=o.y,v=n.x,p=n.y,y=s.x,m=s.y,w=h.x,k=h.y,M=c.x,g=c.y,x=_.x,A=_.y,(z=a.determinant_3x3(l,d,1,v,p,1,y,m,1))*(O=a.determinant_3x3(w,k,1,M,g,1,x,A,1))<0&&i++,l=f.x,d=f.y,v=n.x,p=n.y,y=s.x,m=s.y,w=u.x,k=u.y,M=c.x,g=c.y,x=_.x,A=_.y,(z=a.determinant_3x3(l,d,1,v,p,1,y,m,1))*(O=a.determinant_3x3(w,k,1,M,g,1,x,A,1))<0&&i++,l=f.x,d=f.y,v=o.x,p=o.y,y=s.x,m=s.y,w=u.x,k=u.y,M=h.x,g=h.y,x=_.x,A=_.y,(z=a.determinant_3x3(l,d,1,v,p,1,y,m,1))*(O=a.determinant_3x3(w,k,1,M,g,1,x,A,1))<0&&i++,0!=i&&4!=i)return!1}return!0}}]),r}(T);j.data_t=_,j.matrix_t=k,j.keypoint_t=v,j.pyramid_t=function(t){a(r,t);var e=S(r);function r(t){var a;n(this,r),(a=e.call(this)).levels=0|t,a.data=new Array(t);var i=new j.imgproc;return a.pyrdown=i.pyrdown,a}return u(r,[{key:"allocate",value:function(t,e,r){for(var a=this.levels;--a>=0;)this.data[a]=new k(t>>a,e>>a,r)}},{key:"build",value:function(t,e){void 0===e&&(e=!0);var r=2,a=t,i=this.data[0];if(!e)for(var f=t.cols*t.rows;--f>=0;)i.data[f]=t.data[f];for(i=this.data[1],this.pyrdown(a,i);r<this.levels;++r)a=i,i=this.data[r],this.pyrdown(a,i)}}]),r}(j),j.cache=d,j.imgproc=function(t){a(r,t);var e=S(r);function r(){return n(this,r),e.call(this)}return u(r,[{key:"grayscale",value:function(t,e,r,a,i){void 0===i&&(i=0);var f=0,o=0,n=0,s=0,u=0,h=0,c=4899,_=9617,l=1868,d=4;2!=i&&3!=i||(c=1868,l=4899),1!=i&&3!=i||(d=3);var v=d<<1,b=3*d|0;a.resize(e,r,1);var p=a.data;for(o=0;o<r;++o,s+=e,n+=e*d){for(f=0,u=n,h=s;f<=e-4;f+=4,u+=d<<2,h+=4)p[h]=t[u]*c+t[u+1]*_+t[u+2]*l+8192>>14,p[h+1]=t[u+d]*c+t[u+d+1]*_+t[u+d+2]*l+8192>>14,p[h+2]=t[u+v]*c+t[u+v+1]*_+t[u+v+2]*l+8192>>14,p[h+3]=t[u+b]*c+t[u+b+1]*_+t[u+b+2]*l+8192>>14;for(;f<e;++f,++h,u+=d)p[h]=t[u]*c+t[u+1]*_+t[u+2]*l+8192>>14}}},{key:"resample",value:function(t,e,r,a){var i=t.rows,f=t.cols;i>a&&f>r&&(e.resize(r,a,t.channel),t.type&y&&e.type&y&&i*f/(a*r)<256?function(t,e,r,a,i){for(var f=0,o=t.channel,n=t.cols,s=t.rows,u=t.data,h=e.data,c=n/a,_=s/i,l=c*_*65536|0,d=0,v=0,b=0,p=0,y=0,m=0,w=0,k=0,M=0,g=0,x=0,A=0,z=0,O=0,q=0,C=0,R=r.get_buffer(a*o<<2),B=r.get_buffer(a*o<<2),S=r.get_buffer(2*n*3<<2),j=R.i32,T=B.i32,I=S.i32;d<a;d++){for(y=1+(M=d*c)-1e-6|0,m=0|(g=M+c),y=Math.min(y,n-1),m=Math.min(m,n-1),y>M&&(I[k++]=d*o|0,I[k++]=(y-1)*o|0,I[k++]=256*(y-M)|0,f++),b=y;b<m;b++)f++,I[k++]=d*o|0,I[k++]=b*o|0,I[k++]=256;g-m>.001&&(f++,I[k++]=d*o|0,I[k++]=m*o|0,I[k++]=256*(g-m)|0)}for(d=0;d<a*o;d++)j[d]=T[d]=0;for(v=0,p=0;p<s;p++){for(x=n*p,k=0;k<f;k++)for(z=I[3*k],y=I[3*k+1],O=I[3*k+2],w=0;w<o;w++)j[z+w]+=u[x+y+w]*O;if((v+1)*_<=p+1||p==s-1){if(C=256-(q=256*Math.max(p+1-(v+1)*_,0)|0),A=a*v,q<=0)for(d=0;d<a*o;d++)h[A+d]=Math.min(Math.max((T[d]+256*j[d])/l,0),255),T[d]=j[d]=0;else for(d=0;d<a*o;d++)h[A+d]=Math.min(Math.max((T[d]+j[d]*C)/l,0),255),T[d]=j[d]*q,j[d]=0;v++}else for(d=0;d<a*o;d++)T[d]+=256*j[d],j[d]=0}r.put_buffer(B),r.put_buffer(R),r.put_buffer(S)}(t,e,this.cache,r,a):function(t,e,r,a,i){for(var f=0,o=t.channel,n=t.cols,s=t.rows,u=t.data,h=e.data,c=n/a,_=s/i,l=1/(c*_),d=0,v=0,b=0,p=0,y=0,m=0,w=0,k=0,M=0,g=0,x=0,A=0,z=0,O=0,q=0,C=0,R=r.get_buffer(a*o<<2),B=r.get_buffer(a*o<<2),S=r.get_buffer(2*n*3<<2),j=R.f32,T=B.f32,I=S.f32;d<a;d++){for(y=1+(M=d*c)-1e-6|0,m=0|(g=M+c),y=Math.min(y,n-1),m=Math.min(m,n-1),y>M&&(f++,I[k++]=(y-1)*o|0,I[k++]=d*o|0,I[k++]=(y-M)*l),b=y;b<m;b++)f++,I[k++]=b*o|0,I[k++]=d*o|0,I[k++]=l;g-m>.001&&(f++,I[k++]=m*o|0,I[k++]=d*o|0,I[k++]=(g-m)*l)}for(d=0;d<a*o;d++)j[d]=T[d]=0;for(v=0,p=0;p<s;p++){for(x=n*p,k=0;k<f;k++)for(y=0|I[3*k],z=0|I[3*k+1],O=I[3*k+2],w=0;w<o;w++)j[z+w]+=u[x+y+w]*O;if((v+1)*_<=p+1||p==s-1){if(C=1-(q=Math.max(p+1-(v+1)*_,0)),A=a*v,Math.abs(q)<.001)for(d=0;d<a*o;d++)h[A+d]=T[d]+j[d],T[d]=j[d]=0;else for(d=0;d<a*o;d++)h[A+d]=T[d]+j[d]*C,T[d]=j[d]*q,j[d]=0;v++}else for(d=0;d<a*o;d++)T[d]+=j[d],j[d]=0}r.put_buffer(B),r.put_buffer(R),r.put_buffer(S)}(t,e,this.cache,r,a))}},{key:"box_blur_gray",value:function(t,e,r,a){void 0===a&&(a=0);var i=t.cols,f=t.rows,o=f<<1,n=i<<1,s=0,u=0,h=0,c=0,_=1+(r<<1)|0,l=r+1|0,d=l+1|0,v=1&a?1:1/(_*_),b=this.cache.get_buffer(i*f<<2),p=0,y=0,m=0,w=0,k=0,M=b.i32,g=t.data,x=0;for(e.resize(i,f,t.channel),h=0;h<f;++h){for(y=h,p=l*g[m],s=m+1|0,c=m+r|0;s<=c;++s)p+=g[s];for(w=m+l|0,x=g[k=m],u=0;u<r;++u,y+=f)M[y]=p,p+=g[w]-x,w++;for(;u<i-d;u+=2,y+=o)M[y]=p,p+=g[w]-g[k],M[y+f]=p,p+=g[w+1]-g[k+1],w+=2,k+=2;for(;u<i-l;++u,y+=f)M[y]=p,p+=g[w]-g[k],w++,k++;for(x=g[w-1];u<i;++u,y+=f)M[y]=p,p+=x-g[k],k++;m+=i}if(m=0,g=e.data,1==v)for(h=0;h<i;++h){for(y=h,p=l*M[m],s=m+1|0,c=m+r|0;s<=c;++s)p+=M[s];for(w=m+l,x=M[k=m],u=0;u<r;++u,y+=i)g[y]=p,p+=M[w]-x,w++;for(;u<f-d;u+=2,y+=n)g[y]=p,p+=M[w]-M[k],g[y+i]=p,p+=M[w+1]-M[k+1],w+=2,k+=2;for(;u<f-l;++u,y+=i)g[y]=p,p+=M[w]-M[k],w++,k++;for(x=M[w-1];u<f;++u,y+=i)g[y]=p,p+=x-M[k],k++;m+=f}else for(h=0;h<i;++h){for(y=h,p=l*M[m],s=m+1|0,c=m+r|0;s<=c;++s)p+=M[s];for(w=m+l,x=M[k=m],u=0;u<r;++u,y+=i)g[y]=p*v,p+=M[w]-x,w++;for(;u<f-d;u+=2,y+=n)g[y]=p*v,p+=M[w]-M[k],g[y+i]=p*v,p+=M[w+1]-M[k+1],w+=2,k+=2;for(;u<f-l;++u,y+=i)g[y]=p*v,p+=M[w]-M[k],w++,k++;for(x=M[w-1];u<f;++u,y+=i)g[y]=p*v,p+=x-M[k],k++;m+=f}this.cache.put_buffer(b)}},{key:"gaussian_blur",value:function(t,e,r,a){var i=new j.math;void 0===a&&(a=0),void 0===r&&(r=0);var f=(r=0==r?2*Math.max(1,4*a+1-1e-8)+1|0:r)>>1,o=t.cols,n=t.rows,s=t.type,u=s&y;e.resize(o,n,t.channel);var h,c,_=t.data,l=e.data,d=r+Math.max(n,o)|0,v=this.cache.get_buffer(d<<2),b=this.cache.get_buffer(r<<2);u?(h=v.i32,c=b.i32):s&m?(h=v.i32,c=b.f32):(h=v.f32,c=b.f32),i.get_gaussian_kernel(r,a,c,s),u?function(t,e,r,a,i,f,o,n){for(var s=0,u=0,h=0,c=0,_=0,l=0,d=0,v=0,b=0,p=f[0],y=0,m=a<<1,w=3*a,k=a<<2;s<i;++s){for(l=e[c],u=0;u<n;++u)t[u]=l;for(u=0;u<=a-2;u+=2)t[u+n]=e[c+u],t[u+n+1]=e[c+u+1];for(;u<a;++u)t[u+n]=e[c+u];for(l=e[c+a-1],u=a;u<n+a;++u)t[u+n]=l;for(u=0;u<=a-4;u+=4){for(l=t[u]*p,d=t[u+1]*p,v=t[u+2]*p,b=t[u+3]*p,h=1;h<o;++h)y=f[h],l+=t[h+u]*y,d+=t[h+u+1]*y,v+=t[h+u+2]*y,b+=t[h+u+3]*y;r[_+u]=Math.min(l>>8,255),r[_+u+1]=Math.min(d>>8,255),r[_+u+2]=Math.min(v>>8,255),r[_+u+3]=Math.min(b>>8,255)}for(;u<a;++u){for(l=t[u]*p,h=1;h<o;++h)l+=t[h+u]*f[h];r[_+u]=Math.min(l>>8,255)}c+=a,_+=a}for(s=0;s<a;++s){for(l=r[s],u=0;u<n;++u)t[u]=l;for(h=s,u=0;u<=i-2;u+=2,h+=m)t[u+n]=r[h],t[u+n+1]=r[h+a];for(;u<i;++u,h+=a)t[u+n]=r[h];for(l=r[(i-1)*a+s],u=i;u<n+i;++u)t[u+n]=l;for(_=s,u=0;u<=i-4;u+=4,_+=k){for(l=t[u]*p,d=t[u+1]*p,v=t[u+2]*p,b=t[u+3]*p,h=1;h<o;++h)y=f[h],l+=t[h+u]*y,d+=t[h+u+1]*y,v+=t[h+u+2]*y,b+=t[h+u+3]*y;r[_]=Math.min(l>>8,255),r[_+a]=Math.min(d>>8,255),r[_+m]=Math.min(v>>8,255),r[_+w]=Math.min(b>>8,255)}for(;u<i;++u,_+=a){for(l=t[u]*p,h=1;h<o;++h)l+=t[h+u]*f[h];r[_]=Math.min(l>>8,255)}}}(h,_,l,o,n,c,r,f):function(t,e,r,a,i,f,o,n){for(var s=0,u=0,h=0,c=0,_=0,l=0,d=0,v=0,b=0,p=f[0],y=0,m=a<<1,w=3*a,k=a<<2;s<i;++s){for(l=e[c],u=0;u<n;++u)t[u]=l;for(u=0;u<=a-2;u+=2)t[u+n]=e[c+u],t[u+n+1]=e[c+u+1];for(;u<a;++u)t[u+n]=e[c+u];for(l=e[c+a-1],u=a;u<n+a;++u)t[u+n]=l;for(u=0;u<=a-4;u+=4){for(l=t[u]*p,d=t[u+1]*p,v=t[u+2]*p,b=t[u+3]*p,h=1;h<o;++h)y=f[h],l+=t[h+u]*y,d+=t[h+u+1]*y,v+=t[h+u+2]*y,b+=t[h+u+3]*y;r[_+u]=l,r[_+u+1]=d,r[_+u+2]=v,r[_+u+3]=b}for(;u<a;++u){for(l=t[u]*p,h=1;h<o;++h)l+=t[h+u]*f[h];r[_+u]=l}c+=a,_+=a}for(s=0;s<a;++s){for(l=r[s],u=0;u<n;++u)t[u]=l;for(h=s,u=0;u<=i-2;u+=2,h+=m)t[u+n]=r[h],t[u+n+1]=r[h+a];for(;u<i;++u,h+=a)t[u+n]=r[h];for(l=r[(i-1)*a+s],u=i;u<n+i;++u)t[u+n]=l;for(_=s,u=0;u<=i-4;u+=4,_+=k){for(l=t[u]*p,d=t[u+1]*p,v=t[u+2]*p,b=t[u+3]*p,h=1;h<o;++h)y=f[h],l+=t[h+u]*y,d+=t[h+u+1]*y,v+=t[h+u+2]*y,b+=t[h+u+3]*y;r[_]=l,r[_+a]=d,r[_+m]=v,r[_+w]=b}for(;u<i;++u,_+=a){for(l=t[u]*p,h=1;h<o;++h)l+=t[h+u]*f[h];r[_]=l}}}(h,_,l,o,n,c,r,f),this.cache.put_buffer(v),this.cache.put_buffer(b)}},{key:"hough_transform",value:function(t,e,r,a){for(var i=t.data,f=t.cols,o=t.rows,n=f,s=Math.PI,u=Math.round((s-0)/r),h=Math.round((2*(f+o)+1)/e),c=1/e,_=new Int32Array((u+2)*(h+2)),l=new Float32Array(u),d=new Float32Array(u),v=0,b=0;v<u;v++)l[v]=Math.sin(b)*c,d[v]=Math.cos(b)*c,b+=r;for(var p=0;p<o;p++)for(var y=0;y<f;y++)if(0!=i[p*n+y])for(v=0;v<u;v++){var m=Math.round(y*d[v]+p*l[v]);_[(v+1)*(h+2)+(m+=(h-1)/2)+1]+=1}var w=new Array;for(m=0;m<h;m++)for(v=0;v<u;v++){var k=(v+1)*(h+2)+m+1;_[k]>a&&_[k]>_[k-1]&&_[k]>=_[k+1]&&_[k]>_[k-h-2]&&_[k]>=_[k+h+2]&&w.push(k)}w.sort((function(t,e){return _[t]>_[e]||_[t]==_[e]&&t<e}));var M=Math.min(u*h,w.length),g=1/(h+2),x=new Array;for(p=0;p<M;p++){var A=w[p],z=((m=A-(1+(v=Math.floor(A*g)-1))*(h+2)-1)-.5*(h-1))*e,O=v*r;x.push([z,O])}return x}},{key:"pyrdown",value:function(t,e,r,a){void 0===r&&(r=0),void 0===a&&(a=0);var i=t.cols,f=i>>1,o=t.rows>>1,n=f-(r<<1),s=o-(a<<1),u=0,h=0,c=r+a*i,_=0,l=0,d=0;e.resize(f,o,t.channel);var v=t.data,b=e.data;for(h=0;h<s;++h){for(_=c,d=l,u=0;u<=n-2;u+=2,d+=2,_+=4)b[d]=v[_]+v[_+1]+v[_+i]+v[_+i+1]+2>>2,b[d+1]=v[_+2]+v[_+3]+v[_+i+2]+v[_+i+3]+2>>2;for(;u<n;++u,++d,_+=2)b[d]=v[_]+v[_+1]+v[_+i]+v[_+i+1]+2>>2;c+=i<<1,l+=f}}},{key:"scharr_derivatives",value:function(t,e){var r,a,i,f,o,n,s,u,h=t.cols,c=t.rows,_=h<<1,l=0,d=0,v=0,b=0,p=0,w=0,k=0;e.resize(h,c,2);var M=t.data,g=e.data,x=this.cache.get_buffer(h+2<<2),A=this.cache.get_buffer(h+2<<2);for(t.type&y||t.type&m?(s=x.i32,u=A.i32):(s=x.f32,u=A.f32);d<c;++d,p+=h){for(b=(d>0?d-1:1)*h|0,w=(d<c-1?d+1:c-2)*h|0,k=d*_|0,l=0,v=1;l<=h-2;l+=2,v+=2)r=M[b+l],a=M[w+l],s[v]=3*(r+a)+10*M[p+l],u[v]=a-r,r=M[b+l+1],a=M[w+l+1],s[v+1]=3*(r+a)+10*M[p+l+1],u[v+1]=a-r;for(;l<h;++l,++v)r=M[b+l],a=M[w+l],s[v]=3*(r+a)+10*M[p+l],u[v]=a-r;for(l=h+1|0,s[0]=s[1],s[l]=s[h],u[0]=u[1],u[l]=u[h],l=0;l<=h-4;l+=4)r=u[l+2],a=u[l+1],i=u[l+3],f=u[l+4],o=s[l+2],n=s[l+3],g[k++]=o-s[l],g[k++]=3*(r+u[l])+10*a,g[k++]=n-s[l+1],g[k++]=3*(i+a)+10*r,g[k++]=s[l+4]-o,g[k++]=3*(f+r)+10*i,g[k++]=s[l+5]-n,g[k++]=3*(u[l+5]+i)+10*f;for(;l<h;++l)g[k++]=s[l+2]-s[l],g[k++]=3*(u[l+2]+u[l])+10*u[l+1]}this.cache.put_buffer(x),this.cache.put_buffer(A)}},{key:"sobel_derivatives",value:function(t,e){var r,a,i,f,o,n,s,u,h=t.cols,c=t.rows,_=h<<1,l=0,d=0,v=0,b=0,p=0,w=0,k=0;e.resize(h,c,2);var M=t.data,g=e.data,x=this.cache.get_buffer(h+2<<2),A=this.cache.get_buffer(h+2<<2);for(t.type&y||t.type&m?(s=x.i32,u=A.i32):(s=x.f32,u=A.f32);d<c;++d,p+=h){for(b=(d>0?d-1:1)*h|0,w=(d<c-1?d+1:c-2)*h|0,k=d*_|0,l=0,v=1;l<=h-2;l+=2,v+=2)r=M[b+l],a=M[w+l],s[v]=r+a+2*M[p+l],u[v]=a-r,r=M[b+l+1],a=M[w+l+1],s[v+1]=r+a+2*M[p+l+1],u[v+1]=a-r;for(;l<h;++l,++v)r=M[b+l],a=M[w+l],s[v]=r+a+2*M[p+l],u[v]=a-r;for(l=h+1|0,s[0]=s[1],s[l]=s[h],u[0]=u[1],u[l]=u[h],l=0;l<=h-4;l+=4)r=u[l+2],a=u[l+1],i=u[l+3],f=u[l+4],o=s[l+2],n=s[l+3],g[k++]=o-s[l],g[k++]=r+u[l]+2*a,g[k++]=n-s[l+1],g[k++]=i+a+2*r,g[k++]=s[l+4]-o,g[k++]=f+r+2*i,g[k++]=s[l+5]-n,g[k++]=u[l+5]+i+2*f;for(;l<h;++l)g[k++]=s[l+2]-s[l],g[k++]=u[l+2]+u[l]+2*u[l+1]}this.cache.put_buffer(x),this.cache.put_buffer(A)}},{key:"compute_integral_image",value:function(t,e,r,a){var i=0|t.cols,f=0|t.rows,o=t.data,n=i+1|0,s=0,u=0,h=0,c=0,_=0,l=0,d=0,v=0;if(e&&r){for(;_<n;++_)e[_]=0,r[_]=0;for(h=n+1|0,c=1,_=0,v=0;_<f;++_,++h,++c){for(s=u=0,l=0;l<=i-2;l+=2,v+=2,h+=2,c+=2)s+=d=o[v],u+=d*d,e[h]=e[c]+s,r[h]=r[c]+u,s+=d=o[v+1],u+=d*d,e[h+1]=e[c+1]+s,r[h+1]=r[c+1]+u;for(;l<i;++l,++v,++h,++c)s+=d=o[v],u+=d*d,e[h]=e[c]+s,r[h]=r[c]+u}}else if(e){for(;_<n;++_)e[_]=0;for(h=n+1|0,c=1,_=0,v=0;_<f;++_,++h,++c){for(s=0,l=0;l<=i-2;l+=2,v+=2,h+=2,c+=2)s+=o[v],e[h]=e[c]+s,s+=o[v+1],e[h+1]=e[c+1]+s;for(;l<i;++l,++v,++h,++c)s+=o[v],e[h]=e[c]+s}}else if(r){for(;_<n;++_)r[_]=0;for(h=n+1|0,c=1,_=0,v=0;_<f;++_,++h,++c){for(u=0,l=0;l<=i-2;l+=2,v+=2,h+=2,c+=2)u+=(d=o[v])*d,r[h]=r[c]+u,u+=(d=o[v+1])*d,r[h+1]=r[c+1]+u;for(;l<i;++l,++v,++h,++c)u+=(d=o[v])*d,r[h]=r[c]+u}}if(a){for(_=0;_<n;++_)a[_]=0;for(h=n+1|0,c=0,_=0,v=0;_<f;++_,++h,++c){for(l=0;l<=i-2;l+=2,v+=2,h+=2,c+=2)a[h]=o[v]+a[c],a[h+1]=o[v+1]+a[c+1];for(;l<i;++l,++v,++h,++c)a[h]=o[v]+a[c]}for(h=n+i|0,c=i,_=0;_<f;++_,h+=n,c+=n)a[h]+=a[c];for(l=i-1;l>0;--l)for(c=(h=l+f*n)-n,_=f;_>0;--_,h-=n,c-=n)a[h]+=a[c]+a[c+1]}}},{key:"equalize_histogram",value:function(t,e){var r=t.cols,a=t.rows,i=t.data;e.resize(r,a,t.channel);var f,o,n=e.data,s=r*a,u=0,h=0,c=this.cache.get_buffer(1024);for(f=c.i32;u<256;++u)f[u]=0;for(u=0;u<s;++u)++f[i[u]];for(h=f[0],u=1;u<256;++u)h=f[u]+=h;for(o=255/s,u=0;u<s;++u)n[u]=f[i[u]]*o+.5|0;this.cache.put_buffer(c)}},{key:"canny",value:function(t,e,r,a){var i=t.cols,f=t.rows;t.data,e.resize(i,f,t.channel);var o=e.data,n=0,s=0,u=0,h=i<<1,c=0,_=0,l=0,d=0,v=0,b=0,p=0,y=0,m=this.cache.get_buffer(f*h<<2),w=this.cache.get_buffer(3*(i+2)<<2),M=this.cache.get_buffer((f+2)*(i+2)<<2),g=this.cache.get_buffer(f*i<<2),x=w.i32,A=M.i32,z=g.i32,O=m.i32,q=new k(i,f,514,m.data),C=1,R=i+2+1|0,B=2*(i+2)+1|0,S=i+2|0,j=S+1|0,T=0;for(this.sobel_derivatives(t,q),r>a&&(n=r,r=a,a=n),n=3*(i+2)|0;--n>=0;)x[n]=0;for(n=(f+2)*(i+2)|0;--n>=0;)A[n]=0;for(;s<i;++s,u+=2)d=O[u],v=O[u+1],x[R+s]=(d^d>>31)-(d>>31)+((v^v>>31)-(v>>31));for(n=1;n<=f;++n,u+=h){if(n==f)for(s=B+i;--s>=B;)x[s]=0;else for(s=0;s<i;s++)d=O[u+(s<<1)],v=O[u+(s<<1)+1],x[B+s]=(d^d>>31)-(d>>31)+((v^v>>31)-(v>>31));for(c=u-h|0,A[j-1]=0,_=0,s=0;s<i;++s,c+=2){if((l=x[R+s])>r)if(b=(d=O[c])^(v=O[c+1]),v=(v^v>>31)-(v>>31)|0,y=(p=13573*(d=(d^d>>31)-(d>>31)|0))+(d+d<<15),(v<<=15)<p){if(l>x[R+s-1]&&l>=x[R+s+1]){l>a&&!_&&2!=A[j+s-S]?(A[j+s]=2,_=1,z[T++]=j+s):A[j+s]=1;continue}}else if(v>y){if(l>x[C+s]&&l>=x[B+s]){l>a&&!_&&2!=A[j+s-S]?(A[j+s]=2,_=1,z[T++]=j+s):A[j+s]=1;continue}}else if(l>x[C+s-(b=b<0?-1:1)]&&l>x[B+s+b]){l>a&&!_&&2!=A[j+s-S]?(A[j+s]=2,_=1,z[T++]=j+s):A[j+s]=1;continue}A[j+s]=0,_=0}A[j+i]=0,j+=S,s=C,C=R,R=B,B=s}for(s=j-S-1,n=0;n<S;++n,++s)A[s]=0;for(;T>0;)j=z[--T],1==A[j-=S+1]&&(A[j]=2,z[T++]=j),1==A[j+=1]&&(A[j]=2,z[T++]=j),1==A[j+=1]&&(A[j]=2,z[T++]=j),1==A[j+=S]&&(A[j]=2,z[T++]=j),1==A[j-=2]&&(A[j]=2,z[T++]=j),1==A[j+=S]&&(A[j]=2,z[T++]=j),1==A[j+=1]&&(A[j]=2,z[T++]=j),1==A[j+=1]&&(A[j]=2,z[T++]=j);for(j=S+1,C=0,n=0;n<f;++n,j+=S)for(s=0;s<i;++s)o[C++]=255*(2==A[j+s]);this.cache.put_buffer(m),this.cache.put_buffer(w),this.cache.put_buffer(M),this.cache.put_buffer(g)}},{key:"warp_perspective",value:function(t,e,r,a){void 0===a&&(a=0);for(var i=0|t.cols,f=0|t.rows,o=0|e.cols,n=0|e.rows,s=t.data,u=e.data,h=0,c=0,_=0,l=0,d=0,v=0,b=0,p=0,y=0,m=0,w=0,k=0,M=0,g=0,x=0,A=r.data,z=A[0],O=A[1],q=A[2],C=A[3],R=A[4],B=A[5],S=A[6],j=A[7],T=A[8],I=0;c<n;++c)for(p=O*c+q,y=R*c+B,m=j*c+T,h=0;h<o;++h,++I,p+=z,y+=C,m+=S)l=0|(v=p*(w=1/m)),d=0|(b=y*w),v>0&&b>0&&l<i-1&&d<f-1?(k=Math.max(v-l,0),M=Math.max(b-d,0),g=s[_=i*d+l|0]+k*(s[_+1]-s[_]),x=s[_+i]+k*(s[_+i+1]-s[_+i]),u[I]=g+M*(x-g)):u[I]=a}},{key:"warp_affine",value:function(t,e,r,a){void 0===a&&(a=0);for(var i=t.cols,f=t.rows,o=e.cols,n=e.rows,s=t.data,u=e.data,h=0,c=0,_=0,l=0,d=0,v=0,b=0,p=0,y=0,m=0,w=0,k=r.data,M=k[0],g=k[1],x=k[2],A=k[3],z=k[4],O=k[5],q=0;c<n;++c)for(v=g*c+x,b=z*c+O,h=0;h<o;++h,++q,v+=M,b+=A)d=0|b,(l=0|v)>=0&&d>=0&&l<i-1&&d<f-1?(p=v-l,y=b-d,m=s[_=i*d+l]+p*(s[_+1]-s[_]),w=s[_+i]+p*(s[_+i+1]-s[_+i]),u[q]=m+y*(w-m)):u[q]=a}},{key:"skindetector",value:function(t,e){for(var r,a,i,f,o=t.width*t.height;o--;)f=4*o,r=t.data[f],a=t.data[f+1],i=t.data[f+2],r>95&&a>40&&i>20&&r>a&&r>i&&r-Math.min(a,i)>15&&Math.abs(r-a)>15?e[o]=255:e[o]=0}}]),r}(j),j.math=function(t){a(r,t);var e=S(r);function r(){var t;return n(this,r),(t=e.call(this)).qsort_stack=new Int32Array(96),t}return u(r,[{key:"get_gaussian_kernel",value:function(t,e,r,a){var i=0,f=0,o=0,n=0,s=0,u=0,h=this.cache.get_buffer(t<<2),c=h.f32;if(1==(1&t)&&t<=7&&e<=0)switch(t>>1){case 0:c[0]=1,u=1;break;case 1:c[0]=.25,c[1]=.5,c[2]=.25,u=1;break;case 2:c[0]=.0625,c[1]=.25,c[2]=.375,c[3]=.25,c[4]=.0625,u=1;break;case 3:c[0]=.03125,c[1]=.109375,c[2]=.21875,c[3]=.28125,c[4]=.21875,c[5]=.109375,c[6]=.03125,u=1}else for(s=-.5/((n=e>0?e:.3*(.5*(t-1)-1)+.8)*n);i<t;++i)f=i-.5*(t-1),o=Math.exp(s*f*f),c[i]=o,u+=o;if(a&y)for(u=256/u,i=0;i<t;++i)r[i]=c[i]*u+.5|0;else for(u=1/u,i=0;i<t;++i)r[i]=c[i]*u;this.cache.put_buffer(h)}},{key:"perspective_4point_transform",value:function(t,e,r,a,i,f,o,n,s,u,h,c,_,l,d,v,b){var p=e,y=u,m=o,w=p*y*m,k=d,M=p*k,g=y*M,x=h,A=p*x,z=f,O=r,q=l,C=O*q,R=C*z,B=q*z*x,S=q*m,j=q*x,T=y*m,I=k*y,L=k*z,P=x*z,F=1/(S-j-T+I-L+P),U=p*q,E=O*z,V=m*p,G=k*V,N=O*y,D=C*x,J=O*x*z,Y=m*k*y,H=k*O,Q=-(g-w+A*z-z*M-C*y+R-B+S*y)*F,X=(w-g-U*m+U*x+R-y*E+L*y-B)*F,K=p,W=(-x*M+G+N*m-C*m+D-J+L*x-Y)*F,Z=(V*x-G-H*y+D-J+H*z+Y-S*x)*F,$=O,tt=(-A+V+N-E+j-S-I+L)*F,et=(-M+A+C-N+L-P-S+T)*F,rt=-((g=(y=c)*(M=(p=a)*(k=b)))-(w=p*y*(m=s))+(A=p*(x=_))*(z=n)-z*M-(C=(O=i)*(q=v))*y+(R=C*z)-(B=q*z*x)+(S=q*m)*y)*(F=1/(S-(j=q*x)-(T=y*m)+(I=k*y)-(L=k*z)+(P=x*z))),at=(w-g-(U=p*q)*m+U*x+R-y*(E=O*z)+L*y-B)*F,it=p,ft=(-x*M+(G=k*(V=m*p))+(N=O*y)*m-C*m+(D=C*x)-(J=O*x*z)+L*x-(Y=m*k*y))*F,ot=(V*x-G-(H=k*O)*y+D-J+H*z+Y-S*x)*F,nt=O,st=(-A+V+N-E+j-S-I+L)*F,ut=(-M+A+C-N+L-P-S+T)*F,ht=K*tt;R=$*tt-W;var ct=-W*et+Z*tt,_t=Q-ht;E=Q*et-(A=X*tt);var lt=(w=Q*$)-(g=K*W),dt=(m=Q*Z)-(M=W*X);J=(y=Z-et*$)*(q=1/(m-w*et-M+g*et+A*$-ht*Z));var vt=(P=K*et-X)*q,bt=(V=-X*$+K*Z)*q,pt=t.data;pt[0]=rt*J+at*(R*q)-it*(ct*q),pt[1]=rt*vt+at*(_t*q)-it*(E*q),pt[2]=-rt*bt-at*(lt*q)+it*(dt*q),pt[3]=ft*J+ot*(R*q)-nt*(ct*q),pt[4]=ft*vt+ot*(_t*q)-nt*(E*q),pt[5]=-ft*bt-ot*(lt*q)+nt*(dt*q),pt[6]=st*J+ut*(R*q)-ct*q,pt[7]=st*vt+ut*(_t*q)-E*q,pt[8]=-st*bt-ut*(lt*q)+dt*q}},{key:"qsort",value:function(t,e,r,a){var i,f,o,n,s=0,u=0,h=0,c=0,_=0,l=0,d=0,v=0,b=0,p=0,y=0,m=0,w=0,k=0,M=0,g=0,x=0,A=0,z=this.qsort_stack;if(!(r-e+1<=1))for(z[0]=e,z[1]=r;s>=0;)for(u=z[s<<1],h=z[1+(s<<1)],s--;;){if((_=h-u+1)<=7){for(d=u+1;d<=h;d++)for(v=d;v>u&&a(t[v],t[v-1]);v--)i=t[v],t[v]=t[v-1],t[v-1]=i;break}for(A=0,p=u,m=h,k=u+(_>>1),_>40&&(g=u+(b=_>>3),x=u+(b<<1),f=t[M=u],o=t[g],n=t[x],u=a(f,o)?a(o,n)?g:a(f,n)?x:M:a(n,o)?g:a(f,n)?M:x,g=k,x=k+b,f=t[M=k-b],o=t[g],n=t[x],k=a(f,o)?a(o,n)?g:a(f,n)?x:M:a(n,o)?g:a(f,n)?M:x,g=h-b,x=h,f=t[M=h-(b<<1)],o=t[g],n=t[x],h=a(f,o)?a(o,n)?g:a(f,n)?x:M:a(n,o)?g:a(f,n)?M:x),g=k,x=h,f=t[M=u],o=t[g],n=t[x],(k=a(f,o)?a(o,n)?g:a(f,n)?x:M:a(n,o)?g:a(f,n)?M:x)!=p&&(i=t[k],t[k]=t[p],t[p]=i,k=p),u=y=p+1,h=w=m,f=t[k];;){for(;u<=h&&!a(f,t[u]);)a(t[u],f)||(u>y&&(i=t[y],t[y]=t[u],t[u]=i),A=1,y++),u++;for(;u<=h&&!a(t[h],f);)a(f,t[h])||(h<w&&(i=t[w],t[w]=t[h],t[h]=i),A=1,w--),h--;if(u>h)break;i=t[u],t[u]=t[h],t[h]=i,A=1,u++,h--}if(0==A){for(h=m,d=(u=p)+1;d<=h;d++)for(v=d;v>u&&a(t[v],t[v-1]);v--)i=t[v],t[v]=t[v-1],t[v-1]=i;break}for(l=u-(_=Math.min(y-p,u-y))|0,c=0;c<_;++c,++l)i=t[p+c],t[p+c]=t[l],t[l]=i;for(l=m-(_=Math.min(m-w,w-h))+1|0,c=0;c<_;++c,++l)i=t[u+c],t[u+c]=t[l],t[l]=i;if(l=w-h,(_=u-y)>1)l>1?_>l?(z[++s<<1]=p,z[1+(s<<1)]=p+_-1,u=m-l+1,h=m):(z[++s<<1]=m-l+1,z[1+(s<<1)]=m,u=p,h=p+_-1):(u=p,h=p+_-1);else{if(!(l>1))break;u=m-l+1,h=m}}}},{key:"median",value:function(t,e,r){for(var a,i=0,f=0,o=0,n=e+r>>1;;){if(r<=e)return t[n];if(r==e+1)return t[e]>t[r]&&(a=t[e],t[e]=t[r],t[r]=a),t[n];for(t[i=e+r>>1]>t[r]&&(a=t[i],t[i]=t[r],t[r]=a),t[e]>t[r]&&(a=t[e],t[e]=t[r],t[r]=a),t[i]>t[e]&&(a=t[i],t[i]=t[e],t[e]=a),f=e+1,a=t[i],t[i]=t[f],t[f]=a,o=r;;){do{++f}while(t[e]>t[f]);do{--o}while(t[o]>t[e]);if(o<f)break;a=t[f],t[f]=t[o],t[o]=a}a=t[e],t[e]=t[o],t[o]=a,o<=n?e=f:o>=n&&(r=o-1)}return 0}}]),r}(j),j.matmath=b,j.linalg=function(t){a(r,t);var e=S(r);function r(){var t;return n(this,r),(t=e.call(this)).matmath=new b,t}return u(r,[{key:"JacobiImpl",value:function(t,e,r,a,i,f){var o=0,n=0,s=0,u=0,h=0,c=0,_=0,l=0,d=0,v=f*f*30,b=0,p=0,y=0,m=0,w=0,k=0,x=0,A=0,z=0,O=this.cache.get_buffer(f<<2),q=this.cache.get_buffer(f<<2),C=O.i32,R=q.i32;if(a)for(;o<f;o++){for(s=o*i,n=0;n<f;n++)a[s+n]=0;a[s+o]=1}for(s=0;s<f;s++){if(r[s]=t[(e+1)*s],s<f-1){for(u=s+1,b=Math.abs(t[e*s+u]),o=s+2;o<f;o++)b<(p=Math.abs(t[e*s+o]))&&(b=p,u=o);C[s]=u}if(s>0){for(u=0,b=Math.abs(t[s]),o=1;o<s;o++)b<(p=Math.abs(t[e*o+s]))&&(b=p,u=o);R[s]=u}}if(f>1)for(;d<v;d++){for(s=0,b=Math.abs(t[C[0]]),o=1;o<f-1;o++)b<(p=Math.abs(t[e*o+C[o]]))&&(b=p,s=o);for(h=C[s],o=1;o<f;o++)b<(p=Math.abs(t[e*R[o]+o]))&&(b=p,s=R[o],h=o);if(y=t[e*s+h],Math.abs(y)<=1.192092896e-7)break;for(m=.5*(r[h]-r[s]),x=(w=Math.abs(m)+g(y,m))/(k=g(y,w)),k=y/k,w=y/w*y,m<0&&(k=-k,w=-w),t[e*s+h]=0,r[s]-=w,r[h]+=w,o=0;o<s;o++)l=e*o+h,A=t[_=e*o+s],z=t[l],t[_]=A*x-z*k,t[l]=A*k+z*x;for(o=s+1;o<h;o++)l=e*o+h,A=t[_=e*s+o],z=t[l],t[_]=A*x-z*k,t[l]=A*k+z*x;for(_=e*s+(o=h+1),l=e*h+o;o<f;o++,_++,l++)A=t[_],z=t[l],t[_]=A*x-z*k,t[l]=A*k+z*x;if(a)for(_=i*s,l=i*h,o=0;o<f;o++,_++,l++)A=a[_],z=a[l],a[_]=A*x-z*k,a[l]=A*k+z*x;for(n=0;n<2;n++){if((c=0==n?s:h)<f-1){for(u=c+1,b=Math.abs(t[e*c+u]),o=c+2;o<f;o++)b<(p=Math.abs(t[e*c+o]))&&(b=p,u=o);C[c]=u}if(c>0){for(u=0,b=Math.abs(t[c]),o=1;o<c;o++)b<(p=Math.abs(t[e*o+c]))&&(b=p,u=o);R[c]=u}}}for(s=0;s<f-1;s++){for(u=s,o=s+1;o<f;o++)r[u]<r[o]&&(u=o);if(s!=u&&(M(r,u,s,b),a))for(o=0;o<f;o++)M(a,i*u+o,i*s+o,b)}this.cache.put_buffer(O),this.cache.put_buffer(q)}},{key:"JacobiSVDImpl",value:function(t,e,r,a,i,f,o,n){for(var s=0,u=0,h=0,c=0,_=Math.max(f,30),l=0,d=0,v=0,b=0,p=0,y=0,m=0,w=0,k=0,x=0,A=0,z=0,O=0,q=0,C=0,R=0,B=0,S=4660,j=0,T=0,I=0,L=this.cache.get_buffer(o<<3),P=L.f64;s<o;s++){for(h=0,A=0;h<f;h++)A+=(w=t[s*e+h])*w;if(P[s]=A,a){for(h=0;h<o;h++)a[s*i+h]=0;a[s*i+s]=1}}for(;c<_;c++){for(p=0,s=0;s<o-1;s++)for(u=s+1;u<o;u++){for(l=s*e|0,d=u*e|0,C=P[s],R=0,B=P[u],h=2,R+=t[l]*t[d],R+=t[l+1]*t[d+1];h<f;h++)R+=t[l+h]*t[d+h];if(!(Math.abs(R)<=2.384185792e-7*Math.sqrt(C*B))){for(O=g(R*=2,z=C-B),z<0?(q=.5*(O-z),y=R/(O*(m=Math.sqrt(q/O))*2)):m=R/(O*(y=Math.sqrt((O+z)/(2*O)))*2),C=0,B=0,h=2,k=y*t[l]+m*t[d],x=-m*t[l]+y*t[d],t[l]=k,t[d]=x,C+=k*k,B+=x*x,k=y*t[l+1]+m*t[d+1],x=-m*t[l+1]+y*t[d+1],t[l+1]=k,t[d+1]=x,C+=k*k,B+=x*x;h<f;h++)k=y*t[l+h]+m*t[d+h],x=-m*t[l+h]+y*t[d+h],t[l+h]=k,t[d+h]=x,C+=k*k,B+=x*x;if(P[s]=C,P[u]=B,p=1,a)for(b=u*i|0,h=2,k=y*a[v=s*i|0]+m*a[b],x=-m*a[v]+y*a[b],a[v]=k,a[b]=x,k=y*a[v+1]+m*a[b+1],x=-m*a[v+1]+y*a[b+1],a[v+1]=k,a[b+1]=x;h<o;h++)k=y*a[v+h]+m*a[b+h],x=-m*a[v+h]+y*a[b+h],a[v+h]=k,a[b+h]=x}}if(0==p)break}for(s=0;s<o;s++){for(h=0,A=0;h<f;h++)A+=(w=t[s*e+h])*w;P[s]=Math.sqrt(A)}for(s=0;s<o-1;s++){for(u=s,h=s+1;h<o;h++)P[u]<P[h]&&(u=h);if(s!=u&&(M(P,s,u,A),a)){for(h=0;h<f;h++)M(t,s*e+h,u*e+h,w);for(h=0;h<o;h++)M(a,s*i+h,u*i+h,w)}}for(s=0;s<o;s++)r[s]=P[s];if(a){for(s=0;s<n;s++){for(A=s<o?P[s]:0;A<=1e-37;){for(T=1/f,h=0;h<f;h++)j=0!=(256&(S=214013*S+2531011)>>16)?T:-T,t[s*e+h]=j;for(c=0;c<2;c++)for(u=0;u<s;u++){for(A=0,h=0;h<f;h++)A+=t[s*e+h]*t[u*e+h];for(I=0,h=0;h<f;h++)w=t[s*e+h]-A*t[u*e+h],t[s*e+h]=w,I+=Math.abs(w);for(I=I?1/I:0,h=0;h<f;h++)t[s*e+h]*=I}for(A=0,h=0;h<f;h++)A+=(w=t[s*e+h])*w;A=Math.sqrt(A)}for(m=1/A,h=0;h<f;h++)t[s*e+h]*=m}this.cache.put_buffer(L)}else this.cache.put_buffer(L)}},{key:"lu_solve",value:function(t,e){var r,a,i,f,o=0,n=0,s=0,u=1,h=t.cols,c=t.data,_=e.data;for(o=0;o<h;o++){for(s=o,n=o+1;n<h;n++)Math.abs(c[n*h+o])>Math.abs(c[s*h+o])&&(s=n);if(Math.abs(c[s*h+o])<p)return 0;if(s!=o){for(n=o;n<h;n++)M(c,o*h+n,s*h+n,r);M(_,o,s,r),u=-u}for(i=-1/c[o*h+o],n=o+1;n<h;n++){for(a=c[n*h+o]*i,s=o+1;s<h;s++)c[n*h+s]+=a*c[o*h+s];_[n]+=a*_[o]}c[o*h+o]=-i}for(o=h-1;o>=0;o--){for(f=_[o],s=o+1;s<h;s++)f-=c[o*h+s]*_[s];_[o]=f*c[o*h+o]}return 1}},{key:"cholesky_solve",value:function(t,e){var r,a,i=0,f=0,o=0,n=0,s=0,u=0,h=0,c=t.cols,_=t.data,l=e.data;for(i=0;i<c;i++)for(a=1,s=n=i*c,f=i;f<c;f++){for(r=_[s+i],o=0;o<i;o++)r-=_[o*c+i]*_[s+o];if(f==i){if(_[s+i]=r,0==r)return 0;a=1/r}else _[n+f]=r,_[s+i]=r*a;s+=c}for(n=0,u=0;u<c;u++){for(r=l[u],h=0;h<u;h++)r-=_[n+h]*l[h];l[u]=r,n+=c}for(n=0,u=0;u<c;u++)l[u]/=_[n+u],n+=c;for(u=c-1;u>=0;u--){for(r=l[u],n=(h=u+1)*c;h<c;h++)r-=_[n+u]*l[h],n+=c;l[u]=r}return 1}},{key:"svd_decompose",value:function(t,e,r,a,i){void 0===i&&(i=0);var f=0,o=0,n=t.rows,s=t.cols,u=n,h=s,c=1|t.type;u<h&&(f=1,o=u,u=h,h=o);var _=this.cache.get_buffer(u*u<<3),l=this.cache.get_buffer(h<<3),d=this.cache.get_buffer(h*h<<3),v=new k(u,u,c,_.data),b=new k(1,h,c,l.data),p=new k(h,h,c,d.data);if(0==f)this.matmath.transpose(v,t);else{for(o=0;o<s*n;o++)v.data[o]=t.data[o];for(;o<h*u;o++)v.data[o]=0}if(this.JacobiSVDImpl(v.data,u,b.data,p.data,h,u,h,u),e){for(o=0;o<h;o++)e.data[o]=b.data[o];for(;o<s;o++)e.data[o]=0}if(0==f){if(r&&1&i)for(o=u*u;--o>=0;)r.data[o]=v.data[o];else r&&this.matmath.transpose(r,v);if(a&&2&i)for(o=h*h;--o>=0;)a.data[o]=p.data[o];else a&&this.matmath.transpose(a,p)}else{if(r&&1&i)for(o=h*h;--o>=0;)r.data[o]=p.data[o];else r&&this.matmath.transpose(r,p);if(a&&2&i)for(o=u*u;--o>=0;)a.data[o]=v.data[o];else a&&this.matmath.transpose(a,v)}this.cache.put_buffer(_),this.cache.put_buffer(l),this.cache.put_buffer(d)}},{key:"svd_solve",value:function(t,e,r){var a,i=0,f=0,o=0,n=0,s=0,u=t.rows,h=t.cols,c=0,_=0,l=1|t.type,d=this.cache.get_buffer(u*u<<3),v=this.cache.get_buffer(h<<3),b=this.cache.get_buffer(h*h<<3),y=new k(u,u,l,d.data),m=new k(1,h,l,v.data),w=new k(h,h,l,b.data),M=r.data,g=y.data,x=m.data,A=w.data;for(this.svd_decompose(t,m,y,w,0),a=p*x[0]*h;i<h;i++,s+=h){for(_=0,f=0;f<h;f++)if(x[f]>a){for(o=0,c=0,n=0;o<u;o++,n+=h)c+=g[n+f]*M[o];_+=c*A[s+f]/x[f]}e.data[i]=_}this.cache.put_buffer(d),this.cache.put_buffer(v),this.cache.put_buffer(b)}},{key:"svd_invert",value:function(t,e){var r,a=0,i=0,f=0,o=0,n=0,s=0,u=e.rows,h=e.cols,c=0,_=1|e.type,l=this.cache.get_buffer(u*u<<3),d=this.cache.get_buffer(h<<3),v=this.cache.get_buffer(h*h<<3),b=new k(u,u,_,l.data),y=new k(1,h,_,d.data),m=new k(h,h,_,v.data),w=t.data,M=b.data,g=y.data,x=m.data;for(this.svd_decompose(e,y,b,m,0),r=p*g[0]*h;a<h;a++,n+=h)for(i=0,o=0;i<u;i++,s++){for(f=0,c=0;f<h;f++,o++)g[f]>r&&(c+=x[n+f]*M[o]/g[f]);w[s]=c}this.cache.put_buffer(l),this.cache.put_buffer(d),this.cache.put_buffer(v)}},{key:"eigenVV",value:function(t,e,r){for(var a=t.cols,i=a*a,f=1|t.type,o=this.cache.get_buffer(a*a<<3),n=this.cache.get_buffer(a<<3),s=new k(a,a,f,o.data),u=new k(1,a,f,n.data);--i>=0;)s.data[i]=t.data[i];if(this.JacobiImpl(s.data,a,u.data,e?e.data:null,a,a),r)for(;--a>=0;)r.data[a]=u.data[a];this.cache.put_buffer(o),this.cache.put_buffer(n)}}]),r}(j),j.orb=function(t){a(r,t);var e=S(r);function r(){var t;return n(this,r),(t=e.call(this)).bit_pattern_31_=new Int32Array(x),t.H=new k(3,3,1025),t.patch_img=new k(32,32,257),t.imgproc=new j.imgproc,t}return u(r,[{key:"describe",value:function(t,e,r,a){var i=0,f=0,o=0,n=0,s=0,u=0,h=0,c=0,_=(t.data,t.cols,t.rows,this.patch_img.data),l=528,d=0;a.type&y?a.resize(32,r,1):(a.type=y,a.cols=32,a.rows=r,a.channel=1,a.allocate());var v=a.data,b=0;for(i=0;i<r;++i){for(o=e[i].x,n=e[i].y,s=e[i].angle,A(t,this.patch_img,s,o,n,32,this.H,this.imgproc),d=0,f=0;f<32;++f)u=_[l+32*this.bit_pattern_31_[d+1]+this.bit_pattern_31_[d]],d+=2,h=_[l+32*this.bit_pattern_31_[d+1]+this.bit_pattern_31_[d]],d+=2,c=u<h|0,u=_[l+32*this.bit_pattern_31_[d+1]+this.bit_pattern_31_[d]],d+=2,h=_[l+32*this.bit_pattern_31_[d+1]+this.bit_pattern_31_[d]],d+=2,c|=(u<h)<<1,u=_[l+32*this.bit_pattern_31_[d+1]+this.bit_pattern_31_[d]],d+=2,h=_[l+32*this.bit_pattern_31_[d+1]+this.bit_pattern_31_[d]],d+=2,c|=(u<h)<<2,u=_[l+32*this.bit_pattern_31_[d+1]+this.bit_pattern_31_[d]],d+=2,h=_[l+32*this.bit_pattern_31_[d+1]+this.bit_pattern_31_[d]],d+=2,c|=(u<h)<<3,u=_[l+32*this.bit_pattern_31_[d+1]+this.bit_pattern_31_[d]],d+=2,h=_[l+32*this.bit_pattern_31_[d+1]+this.bit_pattern_31_[d]],d+=2,c|=(u<h)<<4,u=_[l+32*this.bit_pattern_31_[d+1]+this.bit_pattern_31_[d]],d+=2,h=_[l+32*this.bit_pattern_31_[d+1]+this.bit_pattern_31_[d]],d+=2,c|=(u<h)<<5,u=_[l+32*this.bit_pattern_31_[d+1]+this.bit_pattern_31_[d]],d+=2,h=_[l+32*this.bit_pattern_31_[d+1]+this.bit_pattern_31_[d]],d+=2,c|=(u<h)<<6,u=_[l+32*this.bit_pattern_31_[d+1]+this.bit_pattern_31_[d]],d+=2,h=_[l+32*this.bit_pattern_31_[d+1]+this.bit_pattern_31_[d]],d+=2,c|=(u<h)<<7,v[b+f]=c;b+=32}}}]),r}(j),j.yape=C,j.yape06=function(t){a(r,t);var e=S(r);function r(){var t;return n(this,r),(t=e.call(this)).laplacian_threshold=30,t.min_eigen_value_threshold=25,t}return u(r,[{key:"detect",value:function(t,e,r){void 0===r&&(r=5);var a,i=0,f=0,o=t.cols,n=t.rows,s=t.data,u=5*o|0,h=3+3*o|0,c=3-3*o|0,_=this.cache.get_buffer(o*n<<2),l=_.i32,d=0,v=0,b=0,p=0,y=0,m=this.laplacian_threshold,w=this.min_eigen_value_threshold,k=0|Math.max(5,r),M=0|Math.max(3,r),g=0|Math.min(o-5,o-r),x=0|Math.min(n-3,n-r);for(i=o*n;--i>=0;)l[i]=0;for(function(t,e,r,a,i,f,o,n,s,u){var h=0,c=0,_=n*r+o|0,l=_;for(h=n;h<u;++h,l=_+=r)for(c=o;c<s;++c,++l)e[l]=-4*t[l]+t[l+5]+t[l-5]+t[l+f]+t[l-f]}(s,l,o,0,0,u,k,M,g,x),v=M*o+k|0,f=M;f<x;++f,v+=o)for(i=k,b=v;i<g;++i,++b)((d=l[b])<-m&&d<l[b-1]&&d<l[b+1]&&d<l[b-o]&&d<l[b+o]&&d<l[b-o-1]&&d<l[b+o-1]&&d<l[b-o+1]&&d<l[b+o+1]||d>m&&d>l[b-1]&&d>l[b+1]&&d>l[b-o]&&d>l[b+o]&&d>l[b-o-1]&&d>l[b+o-1]&&d>l[b-o+1]&&d>l[b+o+1])&&(p=R(s,b,d,5,u,h,c))>w&&((a=e[y]).x=i,a.y=f,a.score=p,++y,++i,++b);return this.cache.put_buffer(_),y}}]),r}(j),j.motion_estimator=function(t){a(r,t);var e=S(r);function r(){return n(this,r),e.call(this)}return u(r,[{key:"get_subset",value:function(t,e,r,a,i,f,o){for(var n=1e3,s=[],u=0,h=0,c=0,_=0,l=!1;c<n;++c){for(u=0;u<a&&c<n;){for(l=!1,_=0;!l;)for(l=!0,_=s[u]=0|Math.floor(Math.random()*i),h=0;h<u;++h)if(_==s[h]){l=!1;break}f[u]=e[_],o[u]=r[_],t.check_subset(f,o,u+1)?++u:c++}break}return u==a&&c<n}},{key:"find_inliers",value:function(t,e,r,a,i,f,o,n){var s=0,u=0,h=0,c=f*f;for(t.error(r,a,e,o,i);u<i;++u)h=o[u]<=c,n[u]=h,s+=h;return s}},{key:"ransac",value:function(t,e,r,a,i,f,o,n){if(void 0===n&&(n=1e3),i<t.size)return!1;var s=t.size,u=n,h=0,c=!1,_=[],l=[],d=f.cols,v=f.rows,b=1|f.type,p=this.cache.get_buffer(d*v<<3),y=this.cache.get_buffer(i),m=this.cache.get_buffer(i<<2),w=new k(d,v,b,p.data),M=new k(i,1,257,y.data),g=-1,x=0,A=m.f32;if(i==s){if(e.run(r,a,w,i)<=0)return this.cache.put_buffer(p),this.cache.put_buffer(y),this.cache.put_buffer(m),!1;if(w.copy_to(f),o)for(;--i>=0;)o.data[i]=1;return this.cache.put_buffer(p),this.cache.put_buffer(y),this.cache.put_buffer(m),!0}for(;h<u;++h){if(!this.get_subset(e,r,a,s,i,_,l)){if(0==h)return this.cache.put_buffer(p),this.cache.put_buffer(y),this.cache.put_buffer(m),!1;break}e.run(_,l,w,s)<=0||(x=this.find_inliers(e,w,r,a,i,t.thresh,A,M.data))>Math.max(g,s-1)&&(w.copy_to(f),g=x,o&&M.copy_to(o),u=t.update_iters((i-x)/i,u),c=!0)}return this.cache.put_buffer(p),this.cache.put_buffer(y),this.cache.put_buffer(m),c}},{key:"lmeds",value:function(t,e,r,a,i,f,o,n){if(void 0===n&&(n=1e3),i<t.size)return!1;var s=t.size,u=n,h=0,c=!1,_=new j.math,l=[],d=[],v=f.cols,b=f.rows,p=1|f.type,y=this.cache.get_buffer(v*b<<3),m=this.cache.get_buffer(i),w=this.cache.get_buffer(i<<2),M=new k(v,b,p,y.data),g=new k(i,1,257,m.data),x=0,A=w.f32,z=1e9,O=0,q=0;if(t.eps=.45,u=t.update_iters(t.eps,u),i==s){if(e.run(r,a,M,i)<=0)return this.cache.put_buffer(y),this.cache.put_buffer(m),this.cache.put_buffer(w),!1;if(M.copy_to(f),o)for(;--i>=0;)o.data[i]=1;return this.cache.put_buffer(y),this.cache.put_buffer(m),this.cache.put_buffer(w),!0}for(;h<u;++h){if(!this.get_subset(e,r,a,s,i,l,d)){if(0==h)return this.cache.put_buffer(y),this.cache.put_buffer(m),this.cache.put_buffer(w),!1;break}e.run(l,d,M,s)<=0||(e.error(r,a,M,A,i),(q=_.median(A,0,i-1))<z&&(z=q,M.copy_to(f),c=!0))}return c&&(O=2.5*1.4826*(1+5/(i-s))*Math.sqrt(z),O=Math.max(O,.001),x=this.find_inliers(e,f,r,a,i,O,A,g.data),o&&g.copy_to(o),c=x>=s),this.cache.put_buffer(y),this.cache.put_buffer(m),this.cache.put_buffer(w),c}}]),r}(j),j.ransac_params_t=B,j.affine2d=I,j.homography2d=L,j.optical_flow_lk=function(t){a(r,t);var e=S(r);function r(){var t;n(this,r),t=e.call(this);var a=new j.imgproc;return t.scharr_deriv=a.scharr_derivatives,t}return u(r,[{key:"track",value:function(t,e,r,a,i,f,o,n,s,u){void 0===o&&(o=30),void 0===n&&(n=new Uint8Array(i)),void 0===s&&(s=.01),void 0===u&&(u=1e-4);var h=.5*(f-1),c=f*f|0,_=c<<1,l=t.data,d=e.data,v=l[0].data,b=d[0].data,p=l[0].cols,y=l[0].rows,m=0,w=0,M=this.cache.get_buffer(c<<2),g=this.cache.get_buffer(_<<2),x=this.cache.get_buffer(y*(p<<1)<<2),A=new k(p,y,514,x.data),z=M.i32,O=g.i32,q=x.i32,C=0,R=0,B=0,S=0,j=0,T=0,I=0,L=0,P=0,F=0,U=0,E=0,V=0,G=0,N=0,D=0,J=0,Y=0,H=0,Q=0,X=0,K=0,W=0,Z=0,$=0,tt=0,et=0,rt=0,at=0,it=0,ft=0,ot=0,nt=16384,st=1/(1<<20),ut=0,ht=0,ct=0,_t=0,lt=0,dt=0,vt=0,bt=0,pt=0,yt=0,mt=0;for(s*=s;Q<i;++Q)n[Q]=1;var wt=t.levels-1|0;for(Z=wt;Z>=0;--Z)for(I=1/(1<<Z),w=y>>Z,C=(m=p>>Z)<<1,v=l[Z].data,b=d[Z].data,et=m-f|0,rt=w-f|0,this.scharr_deriv(l[Z],A),$=0;$<i;++$)if(X=1+(Q=$<<1),L=r[Q]*I,P=r[X]*I,Z==wt?(F=L,U=P):(F=2*a[Q],U=2*a[X]),a[Q]=F,a[X]=U,0==(K=(D=0|(L-=h))<=0|D>=et|(J=0|(P-=h))<=0|J>=rt)){for(_t=nt-(ut=(1-(at=L-D))*(1-(it=P-J))*nt+.5|0)-(ht=at*(1-it)*nt+.5|0)-(ct=(1-at)*it*nt+.5|0),bt=0,pt=0,yt=0,W=0;W<f;++W)for(B=(R=(W+J)*m+D|0)<<1,j=(S=W*f|0)<<1,K=0;K<f;++K,++R,++S,B+=2)lt=256+(lt=v[R]*ut+v[R+1]*ht+v[R+m]*ct+v[R+m+1]*_t)>>9,dt=8192+(dt=q[B]*ut+q[B+2]*ht+q[B+C]*ct+q[B+C+2]*_t)>>14,vt=8192+(vt=q[B+1]*ut+q[B+3]*ht+q[B+C+1]*ct+q[B+C+3]*_t)>>14,z[S]=lt,O[j++]=dt,O[j++]=vt,bt+=dt*dt,pt+=dt*vt,yt+=vt*vt;if(mt=(bt*=st)*(yt*=st)-(pt*=st)*pt,(yt+bt-Math.sqrt((bt-yt)*(bt-yt)+4*pt*pt))/_<u||mt<1.1920929e-7)0==Z&&(n[$]=0);else for(mt=1/mt,F-=h,U-=h,E=0,V=0,tt=0;tt<o;++tt){if(0!=(K=(Y=0|F)<=0|Y>=et|(H=0|U)<=0|H>=rt)){0==Z&&(n[$]=0);break}for(_t=nt-(ut=(1-(at=F-Y))*(1-(it=U-H))*nt+.5|0)-(ht=at*(1-it)*nt+.5|0)-(ct=(1-at)*it*nt+.5|0),ft=0,ot=0,W=0;W<f;++W)for(T=(W+H)*m+Y|0,j=(S=W*f|0)<<1,K=0;K<f;++K,++T,++S)lt=256+(lt=b[T]*ut+b[T+1]*ht+b[T+m]*ct+b[T+m+1]*_t)>>9,ft+=(lt-=z[S])*O[j++],ot+=lt*O[j++];if(F+=G=(pt*(ot*=st)-yt*(ft*=st))*mt,U+=N=(pt*ft-bt*ot)*mt,a[Q]=F+h,a[X]=U+h,G*G+N*N<=s)break;if(tt>0&&Math.abs(G+E)<.01&&Math.abs(N+V)<.01){a[Q]-=.5*G,a[X]-=.5*N;break}E=G,V=N}}else 0==Z&&(n[$]=0);this.cache.put_buffer(M),this.cache.put_buffer(g),this.cache.put_buffer(x)}}]),r}(j);const P={jsfeatNext:j};return e.default})()));